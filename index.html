<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Illusionist OS - Calendar</title>

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Illusionist OS">
  <meta name="theme-color" content="#050507">
  <meta name="mobile-web-app-capable" content="yes">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;800&family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #050507;
      --panel: rgba(255,255,255,.10);
      --panel2: rgba(255,255,255,.12);
      --stroke: rgba(255,255,255,.15);
      --gold: #f59e0b;
      --muted: #94a3b8;
      --text: #f1f5f9;
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
      --safe-left: env(safe-area-inset-left);
      --safe-right: env(safe-area-inset-right);
      --font-display: 'Cinzel', serif;
      --font-body: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
      --font-mono: 'JetBrains Mono', 'SF Mono', Monaco, monospace;
    }

    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      max-width: 100%;
    }

    html, body {
      height: 100%;
      background: var(--bg);
      color: var(--text);
      overflow-x: hidden !important;
      max-width: 100vw !important;
      width: 100% !important;
      height: -webkit-fill-available;
      scroll-behavior: smooth;
      font-size: 16px;
    }

    body {
      font-family: var(--font-body);
      overflow-x: hidden;
      min-height: 100vh;
      min-height: -webkit-fill-available;
      min-height: 100dvh;
      padding: 0;
      margin: 0;
      overscroll-behavior: none;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
      position: relative;
    }

    /* Touch optimization */
    * {
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
    }

    input, textarea {
      -webkit-user-select: text;
      user-select: text;
    }

    h1, h2, h3 {
      font-family: var(--font-display);
      font-weight: 600;
      letter-spacing: 0.05em;
    }


    /* TAB SYSTEM */
    .tab-content {
      display: none;
      position: fixed;
      top: var(--safe-top);
      left: var(--safe-left);
      right: var(--safe-right);
      bottom: var(--safe-bottom);
      width: auto;
      height: auto;
      z-index: 1;
    }

    .tab-content.active {
      display: flex;
      flex-direction: column;
    }

    /* PREMIUM GLASS PANEL */
    .glass-panel {
      background: transparent;
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1.5px solid rgba(245,158,11,0.2);
      box-shadow: none;
      border-radius: 24px;
      position: relative;
      overflow-x: hidden;
    }

    /* HEADER */
    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      border-bottom: 1px solid rgba(245,158,11,0.1);
      background: linear-gradient(180deg, rgba(245,158,11,0.03) 0%, transparent 100%);
    }

    /* Header Icon (like calculator) */
    .header-icon {
      width: 48px;
      height: 48px;
      border-radius: 16px;
      position: relative;
      background:
        radial-gradient(120% 120% at 30% 20%, rgba(245,158,11,.22) 0%, rgba(245,158,11,0) 55%),
        radial-gradient(120% 120% at 70% 80%, rgba(168,85,247,.18) 0%, rgba(168,85,247,0) 55%),
        rgba(10,10,14,.88);
      border: 1px solid rgba(245,158,11,.22);
      box-shadow:
        0 10px 28px rgba(0,0,0,.55),
        inset 0 0 0 1px rgba(255,255,255,.05);
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .header-icon::after {
      content: "";
      position: absolute;
      inset: -40%;
      background: conic-gradient(from 120deg, rgba(245,158,11,.0), rgba(245,158,11,.18), rgba(168,85,247,.12), rgba(245,158,11,.0));
      filter: blur(10px);
      opacity: .55;
      transform: rotate(18deg);
    }
    
    .header-icon .inner {
      position: absolute;
      inset: 7px;
      border-radius: 12px;
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.06);
    }
    
    .header-icon i {
      position: relative;
      z-index: 2;
      width: 24px;
      height: 24px;
      color: rgba(245,158,11,.95);
      filter: drop-shadow(0 6px 14px rgba(245,158,11,.20));
      stroke-width: 2.2;
    }

    .month-title {
      font-family: 'Cinzel', serif;
      font-size: 24px;
      font-weight: 800;
      background: linear-gradient(135deg, #f59e0b 0%, #fb923c 50%, #ea580c 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: 0.02em;
      white-space: nowrap;
      text-shadow: 0 0 30px rgba(245,158,11,0.3);
    }

    .header-btn {
      width: 44px;
      height: 44px;
      background: rgba(245,158,11,0.08);
      border: 1px solid rgba(245,158,11,0.15);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      color: rgba(245,158,11,0.9);
    }

    .header-btn:hover {
      background: rgba(255,255,255,.14);
      border-color: rgba(255,255,255,.22);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .header-btn:active {
      transform: translateY(0);
    }

    /* CALENDAR CONTAINER */
    .calendar-container {
      padding: 8px;
      padding-bottom: 20px;
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
      min-height: 0;
      position: relative;
    }

    .calendar-container::-webkit-scrollbar {
      width: 4px;
    }

    .calendar-container::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.02);
      border-radius: 4px;
    }

    .calendar-container::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, rgba(245,158,11,0.3), rgba(245,158,11,0.15));
      border-radius: 4px;
    }

    /* DAY HEADERS */
    .day-headers {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-bottom: 12px;
      padding: 0 4px;
    }

    .day-header {
      text-align: center;
      font-size: 11px;
      font-weight: 700;
      color: rgba(245,158,11,0.6);
      text-transform: uppercase;
      padding: 8px 0;
      letter-spacing: 0.08em;
    }

    /* CALENDAR GRID */
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: clamp(6px, 1.8vh, 18px);
      margin-bottom: 12px;
    }

    .calendar-cell {
      aspect-ratio: 1;
      background: linear-gradient(135deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
      border: 1px solid rgba(245,158,11,0.08);
      border-radius: clamp(12px, 2vw, 16px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: clamp(6px, 1vh, 10px);
      gap: 2px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .calendar-cell::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 50% 0%, rgba(245,158,11,0.08), transparent 70%);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .calendar-cell:hover::before {
      opacity: 1;
    }

    .calendar-cell:hover {
      background: linear-gradient(135deg, rgba(245,158,11,0.08) 0%, rgba(245,158,11,0.03) 100%);
      border-color: rgba(245,158,11,0.25);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(245,158,11,0.15);
    }

    .calendar-cell.today {
      border-color: rgba(245,158,11,0.5);
      background: linear-gradient(135deg, rgba(245,158,11,0.12) 0%, rgba(245,158,11,0.06) 100%);
      box-shadow: 
        0 0 20px rgba(245,158,11,0.25),
        inset 0 0 20px rgba(245,158,11,0.08);
    }

    .calendar-cell.today .date-number {
      background: linear-gradient(135deg, #f59e0b, #fb923c);
      color: #000;
      font-weight: 900;
      box-shadow: 0 4px 12px rgba(245,158,11,0.4);
    }

    .calendar-cell.selected {
      border-color: rgba(245,158,11,0.6);
      background: linear-gradient(135deg, rgba(245,158,11,0.15) 0%, rgba(245,158,11,0.08) 100%);
    }

    .date-number {
      font-size: 12px;
      font-weight: 700;
      color: rgba(255,255,255,0.7);
      width: 26px;
      height: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      transition: all 0.3s;
    }

    .event-dots {
      display: flex;
      gap: 2px;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 90%;
    }

    .event-dot {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      box-shadow: 0 0 6px currentColor;
    }

    .event-label {
      font-size: 8px;
      font-weight: 800;
      text-transform: uppercase;
      padding: 3px 6px;
      border-radius: 6px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      width: 90%;
      text-align: center;
      letter-spacing: 0.03em;
      backdrop-filter: blur(8px);
    }

    .event-stage { 
      background: rgba(245,158,11,0.2); 
      color: #f59e0b;
      border: 1px solid rgba(245,158,11,0.3);
      box-shadow: 0 0 12px rgba(245,158,11,0.2);
    }
    .event-closeup { 
      background: rgba(168,85,247,0.2); 
      color: #c084fc;
      border: 1px solid rgba(168,85,247,0.3);
      box-shadow: 0 0 12px rgba(168,85,247,0.2);
    }
    .event-kids { 
      background: rgba(16,185,129,0.2); 
      color: #34d399;
      border: 1px solid rgba(16,185,129,0.3);
      box-shadow: 0 0 12px rgba(16,185,129,0.2);
    }
    .event-concert { 
      background: rgba(59,130,246,0.2); 
      color: #60a5fa;
      border: 1px solid rgba(59,130,246,0.3);
      box-shadow: 0 0 12px rgba(59,130,246,0.2);
    }
    .event-rehearsal { 
      background: rgba(148,163,184,0.2); 
      color: #cbd5e1;
      border: 1px solid rgba(148,163,184,0.3);
      box-shadow: 0 0 12px rgba(148,163,184,0.15);
    }

    /* DAY LIST */
    .day-list {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid rgba(245,158,11,0.1);
    }

    .day-list-header {
      font-size: 12px;
      font-weight: 800;
      color: rgba(245,158,11,0.8);
      text-transform: uppercase;
      margin-bottom: 16px;
      letter-spacing: 0.1em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .day-list-header::before {
      content: '';
      width: 4px;
      height: 16px;
      background: linear-gradient(180deg, #f59e0b, #fb923c);
      border-radius: 2px;
      box-shadow: 0 0 8px rgba(245,158,11,0.5);
    }

    .day-list-row {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px;
      background: linear-gradient(135deg, rgba(255,255,255,0.04) 0%, rgba(255,255,255,0.02) 100%);
      border: 1px solid rgba(245,158,11,0.1);
      border-radius: 16px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .day-list-row::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: linear-gradient(180deg, var(--accent-color), transparent);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .day-list-row:hover::before {
      opacity: 1;
    }

    .day-list-row:hover {
      background: linear-gradient(135deg, rgba(245,158,11,0.08) 0%, rgba(245,158,11,0.04) 100%);
      border-color: rgba(245,158,11,0.25);
      transform: translateX(4px);
      box-shadow: 0 8px 24px rgba(245,158,11,0.12);
    }

    .day-list-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      flex-shrink: 0;
      box-shadow: 0 0 12px currentColor;
    }

    .day-list-info {
      flex: 1;
      min-width: 0;
    }

    .day-list-title {
      font-size: 14px;
      font-weight: 700;
      color: #fff;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-bottom: 4px;
    }

    .day-list-subtitle {
      font-size: 12px;
      color: rgba(245,158,11,0.7);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .day-list-time {
      font-size: 13px;
      font-weight: 900;
      background: linear-gradient(135deg, #f59e0b, #fb923c);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-family: 'JetBrains Mono', monospace;
      flex-shrink: 0;
    }

    /* DASHBOARD */
    .dashboard-container {
      padding: 12px 16px;
      padding-top: 8px;
      padding-bottom: 120px;
      height: 100%;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }

    .dashboard-container::-webkit-scrollbar {
      width: 4px;
    }

    .dashboard-container::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.02);
    }

    .dashboard-container::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, rgba(245,158,11,0.3), rgba(245,158,11,0.15));
      border-radius: 4px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%);
      border: 1px solid rgba(245,158,11,0.12);
      border-radius: 20px;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, rgba(245,158,11,0.1), transparent 70%);
      pointer-events: none;
    }

    .stat-label {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      color: rgba(245,158,11,0.7);
      letter-spacing: 0.1em;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 900;
      background: linear-gradient(135deg, #f59e0b, #fb923c);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-family: 'JetBrains Mono', monospace;
    }

    .stat-icon {
      position: absolute;
      top: 16px;
      right: 16px;
      color: rgba(245,158,11,0.2);
      width: 32px;
      height: 32px;
    }

    /* MODALS */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      display: flex;
      align-items: flex-end;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .modal-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      width: 100%;
      max-width: 600px;
      max-height: 90vh;
      background: #000;
      backdrop-filter: blur(40px);
      -webkit-backdrop-filter: blur(40px);
      border: 1px solid rgba(245,158,11,0.2);
      border-radius: 32px 32px 0 0;
      box-shadow: 0 -8px 40px rgba(0,0,0,0.8);
      transform: translateY(100%);
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      flex-direction: column;
      padding-bottom: calc(var(--safe-bottom) + 20px);
    }

    .modal-overlay.show .modal-content {
      transform: translateY(0);
    }

    .modal-header {
      padding: 24px 24px 20px;
      border-bottom: 1px solid rgba(245,158,11,0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(180deg, rgba(245,158,11,0.04) 0%, transparent 100%);
    }

    .modal-title {
      font-family: 'Cinzel', serif;
      font-size: 22px;
      font-weight: 800;
      background: linear-gradient(135deg, #f59e0b, #fb923c);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .modal-close {
      width: 40px;
      height: 40px;
      background: rgba(245,158,11,0.08);
      border: 1px solid rgba(245,158,11,0.15);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: rgba(245,158,11,0.9);
      transition: all 0.3s;
    }

    .modal-close:hover {
      background: rgba(245,158,11,0.15);
      border-color: rgba(245,158,11,0.35);
      transform: rotate(90deg);
    }

    .modal-body {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 24px;
      padding-left: max(24px, env(safe-area-inset-left)) !important;
      padding-right: max(24px, env(safe-area-inset-right)) !important;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }

    .modal-body::-webkit-scrollbar {
      width: 4px;
    }

    .modal-body::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.02);
    }

    .modal-body::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, rgba(245,158,11,0.3), rgba(245,158,11,0.15));
      border-radius: 4px;
    }

    /* TABS IN MODAL */
    .modal-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      padding: 6px;
      background: rgba(255,255,255,0.02);
      border-radius: 16px;
      border: 1px solid rgba(245,158,11,0.08);
    }

    .modal-tab {
      flex: 1;
      padding: 12px 16px;
      background: transparent;
      border: 1px solid transparent;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 700;
      color: rgba(255,255,255,0.5);
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .modal-tab:hover {
      color: rgba(245,158,11,0.8);
      background: rgba(245,158,11,0.05);
    }

    .modal-tab.active {
      background: linear-gradient(135deg, rgba(245,158,11,0.15) 0%, rgba(245,158,11,0.08) 100%);
      border-color: rgba(245,158,11,0.25);
      color: #f59e0b;
      box-shadow: 0 4px 16px rgba(245,158,11,0.15);
    }

    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    /* FORM ELEMENTS */
    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      color: rgba(245,158,11,0.8);
      margin-bottom: 10px;
      letter-spacing: 0.08em;
    }

    .form-input, .form-textarea, .form-select {
      width: 100%;
      background: rgba(255,255,255,.08);
      border: 1.5px solid rgba(255,255,255,.12);
      border-radius: 14px;
      padding: 14px 16px;
      font-size: 15px;
      color: #e2e8f0;
      outline: none;
      transition: all 0.2s;
      min-height: 50px;
      -webkit-appearance: none;
      appearance: none;
      font-family: var(--font-body);
    }

    .form-input:focus, .form-textarea:focus, .form-select:focus {
      border-color: rgba(245,158,11,.4);
      box-shadow: 0 0 0 4px rgba(245,158,11,.12);
      background: rgba(255,255,255,.10);
    }

    .form-input::placeholder, .form-textarea::placeholder {
      color: #94a3b8;
    }

    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }

    /* TYPE SELECTOR */
    .type-selector {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .type-button {
      aspect-ratio: 1;
      background: linear-gradient(135deg, rgba(255,255,255,0.04) 0%, rgba(255,255,255,0.02) 100%);
      border: 1px solid rgba(245,158,11,0.08);
      border-radius: 14px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      color: rgba(255,255,255,0.5);
      padding: 12px;
    }

    .type-button:hover {
      border-color: rgba(245,158,11,0.25);
      background: linear-gradient(135deg, rgba(245,158,11,0.08) 0%, rgba(245,158,11,0.04) 100%);
      transform: translateY(-2px);
    }

    .type-button.active {
      border-color: rgba(245,158,11,0.4);
      background: linear-gradient(135deg, rgba(245,158,11,0.15) 0%, rgba(245,158,11,0.08) 100%);
      color: var(--type-color);
      box-shadow: 0 4px 20px rgba(245,158,11,0.2);
    }

    .type-button i {
      width: 24px;
      height: 24px;
    }

    .type-label {
      font-size: 9px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* SCHEDULE */
    .schedule-section {
      margin-bottom: 24px;
    }

    .schedule-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .schedule-title {
      font-size: 13px;
      font-weight: 800;
      text-transform: uppercase;
      color: rgba(245,158,11,0.8);
      letter-spacing: 0.08em;
    }

    .schedule-add {
      padding: 8px 16px;
      background: linear-gradient(135deg, rgba(245,158,11,0.15) 0%, rgba(245,158,11,0.08) 100%);
      border: 1px solid rgba(245,158,11,0.25);
      border-radius: 10px;
      color: #f59e0b;
      font-size: 12px;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .schedule-add:hover {
      background: linear-gradient(135deg, rgba(245,158,11,0.25) 0%, rgba(245,158,11,0.15) 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(245,158,11,0.25);
    }

    .schedule-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .schedule-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      background: linear-gradient(135deg, rgba(255,255,255,0.04) 0%, rgba(255,255,255,0.02) 100%);
      border: 1px solid rgba(245,158,11,0.1);
      border-radius: 14px;
      transition: all 0.3s;
    }

    .schedule-item:hover {
      border-color: rgba(245,158,11,0.2);
      background: linear-gradient(135deg, rgba(245,158,11,0.06) 0%, rgba(245,158,11,0.03) 100%);
    }

    .schedule-type-btn {
      width: 44px;
      height: 44px;
      background: rgba(245,158,11,0.08);
      border: 1px solid rgba(245,158,11,0.15);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      flex-shrink: 0;
    }

    .schedule-type-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 16px currentColor;
    }

    .schedule-type-btn i {
      width: 20px;
      height: 20px;
    }

    .schedule-inputs {
      flex: 1;
      display: flex;
      gap: 8px;
    }

    .schedule-inputs input {
      padding: 10px 12px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(245,158,11,0.12);
      border-radius: 10px;
      color: #fff;
      font-size: 14px;
      font-weight: 600;
      font-family: 'JetBrains Mono', monospace;
    }

    .schedule-duration {
      width: 70px;
      padding: 10px 12px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(245,158,11,0.12);
      border-radius: 10px;
      color: #fff;
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      font-family: 'JetBrains Mono', monospace;
    }

    .schedule-remove {
      width: 36px;
      height: 36px;
      background: rgba(239,68,68,0.1);
      border: 1px solid rgba(239,68,68,0.2);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: #ef4444;
      transition: all 0.3s;
      flex-shrink: 0;
    }

    .schedule-remove:hover {
      background: rgba(239,68,68,0.2);
      border-color: rgba(239,68,68,0.4);
      transform: scale(1.1);
    }

    /* BALANCE DISPLAY */
    .balance-group {
      background: linear-gradient(135deg, rgba(245,158,11,0.12) 0%, rgba(245,158,11,0.06) 100%);
      border: 1px solid rgba(245,158,11,0.25);
      border-radius: 16px;
      padding: 20px;
      margin-top: 20px;
    }

    .balance-label {
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      color: rgba(245,158,11,0.8);
      margin-bottom: 8px;
      letter-spacing: 0.08em;
    }

    .balance-value {
      font-size: 32px;
      font-weight: 900;
      background: linear-gradient(135deg, #f59e0b, #fb923c);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-family: 'JetBrains Mono', monospace;
    }

    /* BUTTONS */
    .btn-primary {
      width: 100%;
      border-radius: 16px;
      padding: 14px 18px;
      font-size: 15px;
      font-weight: 800;
      letter-spacing: 0.02em;
      background: linear-gradient(135deg, rgba(245,158,11,.95), rgba(245,158,11,.75));
      color: #120a00;
      border: 1.5px solid rgba(245,158,11,.4);
      box-shadow: 0 12px 30px rgba(245,158,11,.2);
      min-height: 52px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary:hover {
      filter: brightness(1.08);
      transform: translateY(-1px);
      box-shadow: 0 16px 40px rgba(245,158,11,.3), 0 0 20px rgba(245,158,11,.15);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-secondary {
      width: 100%;
      border-radius: 16px;
      padding: 14px 18px;
      font-size: 14px;
      font-weight: 700;
      background: rgba(255,255,255,.12);
      color: #f1f5f9;
      border: 1.5px solid rgba(255,255,255,.18);
      min-height: 52px;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 12px;
    }

    .btn-secondary:hover {
      background: rgba(255,255,255,.16);
      border-color: rgba(255,255,255,.25);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .btn-danger {
      width: 100%;
      border-radius: 14px;
      padding: 14px 18px;
      font-size: 15px;
      font-weight: 900;
      background: rgba(239,68,68,.12);
      border: 1px solid rgba(239,68,68,0.3);
      color: #ef4444;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 12px;
    }

    .btn-danger:hover {
      background: linear-gradient(135deg, rgba(239,68,68,0.25) 0%, rgba(239,68,68,0.15) 100%);
      border-color: rgba(239,68,68,0.5);
    }

    /* BOTTOM NAV - –†–ê–ó–î–ï–õ–Å–ù–ù–´–ï –ö–ù–û–ü–ö–ò */
    #bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 100;
      padding: 0 20px;
      padding-bottom: max(24px, env(safe-area-inset-bottom, 0px));
      background: transparent;
      pointer-events: none;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
    }

    .nav-inner {
      pointer-events: all;
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: 0;
      position: relative;
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
    }

    .nav-item {
      width: 64px;
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: 2px solid rgba(245,158,11,0.25);
      border-radius: 50%;
      color: rgba(148,163,184,0.8);
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .nav-item:hover {
      transform: translateY(-4px);
      border-color: rgba(245,158,11,0.4);
      color: rgba(245,158,11,0.9);
    }

    .nav-item.active {
      border-color: rgba(245,158,11,0.6);
      color: #f59e0b;
      transform: translateY(-4px);
    }

    /* FAB - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
    .nav-item:nth-child(2) {
      width: 80px;
      height: 80px;
      background: transparent;
      border: 2.5px solid rgba(245,158,11,0.35);
      margin-bottom: 12px;
    }

    .nav-item:nth-child(2):hover {
      transform: translateY(-6px) scale(1.05);
      border-color: rgba(245,158,11,0.6);
    }

    .nav-item:nth-child(2).active {
      background: transparent;
      transform: translateY(-6px) scale(1.05);
    }

    .nav-item i {
      width: 26px;
      height: 26px;
      transition: all 0.3s;
    }

    .nav-item:nth-child(2) i {
      width: 36px;
      height: 36px;
    }

    .nav-item.active i {
      filter: drop-shadow(0 0 8px currentColor);
    }

    .nav-label {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }


    /* TOAST */
    #toast {
      position: fixed;
      top: calc(20px + env(safe-area-inset-top, 0px));
      left: 50%;
      transform: translateX(-50%) translateY(-120px);
      padding: 16px 24px;
      background: linear-gradient(135deg, rgba(20,25,35,0.95) 0%, rgba(10,15,25,0.98) 100%);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(245,158,11,0.3);
      border-radius: 16px;
      color: #f59e0b;
      font-size: 14px;
      font-weight: 700;
      z-index: 10000;
      box-shadow: 
        0 8px 32px rgba(0,0,0,0.6),
        0 0 40px rgba(245,158,11,0.2);
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: none;
    }

    #toast.show {
      transform: translateX(-50%) translateY(0);
    }

    /* MONTH PICKER */
    .month-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin: 24px 0;
    }

    .month-btn {
      padding: 16px;
      background: linear-gradient(135deg, rgba(255,255,255,0.04) 0%, rgba(255,255,255,0.02) 100%);
      border: 1px solid rgba(245,158,11,0.08);
      border-radius: 14px;
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }

    .month-btn:hover {
      background: linear-gradient(135deg, rgba(245,158,11,0.08) 0%, rgba(245,158,11,0.04) 100%);
      border-color: rgba(245,158,11,0.25);
      color: #f59e0b;
      transform: translateY(-2px);
    }

    .month-btn.active {
      background: linear-gradient(135deg, rgba(245,158,11,0.15) 0%, rgba(245,158,11,0.08) 100%);
      border-color: rgba(245,158,11,0.4);
      color: #f59e0b;
      box-shadow: 0 4px 20px rgba(245,158,11,0.2);
    }

    /* COLOR PICKER */
    .color-btn {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 12px;
      border: 2px solid rgba(255,255,255,0.1);
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }

    .color-btn:hover {
      transform: scale(1.1);
      border-color: rgba(255,255,255,0.3);
    }

    .color-btn.selected {
      border-color: #fff;
      border-width: 3px;
      box-shadow: 0 0 20px currentColor;
    }

    .color-btn.selected::after {
      content: '‚úì';
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #000;
      font-size: 18px;
      font-weight: 900;
      text-shadow: 0 0 4px rgba(255,255,255,0.8);
    }

    /* ICON PICKER */
    .icon-btn {
      aspect-ratio: 1;
      background: linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border: 1px solid rgba(245,158,11,0.1);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      color: rgba(255,255,255,0.6);
    }

    .icon-btn:hover {
      background: linear-gradient(135deg, rgba(245,158,11,0.08), rgba(245,158,11,0.04));
      border-color: rgba(245,158,11,0.25);
      color: #f59e0b;
      transform: scale(1.05);
    }

    .icon-btn.selected {
      background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(245,158,11,0.08));
      border-color: rgba(245,158,11,0.4);
      color: #f59e0b;
      box-shadow: 0 4px 16px rgba(245,158,11,0.3);
    }

    .icon-btn i {
      width: 20px;
      height: 20px;
    }

    .year-selector {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 24px;
      margin-bottom: 24px;
      padding: 20px;
      background: linear-gradient(135deg, rgba(245,158,11,0.08) 0%, rgba(245,158,11,0.04) 100%);
      border: 1px solid rgba(245,158,11,0.15);
      border-radius: 16px;
    }

    .year-btn {
      width: 44px;
      height: 44px;
      background: rgba(245,158,11,0.1);
      border: 1px solid rgba(245,158,11,0.2);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: #f59e0b;
      transition: all 0.3s;
    }

    .year-btn:hover {
      background: rgba(245,158,11,0.2);
      border-color: rgba(245,158,11,0.35);
      transform: scale(1.1);
    }

    .year-display {
      font-size: 28px;
      font-weight: 900;
      background: linear-gradient(135deg, #f59e0b, #fb923c);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-family: 'JetBrains Mono', monospace;
      min-width: 120px;
      text-align: center;
    }

    /* MEDIA QUERIES */
    @media (max-width: 768px) {
      input[type="text"],
      input[type="number"],
      input[type="date"],
      input[type="time"],
      select,
      textarea {
        font-size: 16px !important;
      }
    }

    @media (max-width: 480px) {
      .glass-panel {
        border-radius: 24px !important;
        padding: 20px !important;
      }

      .calendar-header {
        padding: 12px 16px !important;
      }

      .btn-gold,
      .btn-secondary {
        padding: 12px 16px !important;
        font-size: 14px !important;
      }

      .modal-header {
        padding: 20px 16px;
      }

      .modal-body {
        padding: 20px 16px;
      }
    }

    @media (max-width: 430px) {
      .glass-panel {
        padding: 16px !important;
      }

      .calendar-grid {
        gap: 6px;
      }

      .schedule-item {
        padding: 12px;
        gap: 10px;
      }

      .day-list-row {
        padding: 14px 12px;
      }
    }

    @media (max-width: 380px) {
      .calendar-header .month-title {
        font-size: 18px !important;
      }

      .glass-panel {
        padding: 12px !important;
      }

      .calendar-grid {
        gap: 4px;
      }

      .date-number {
        font-size: 10px;
        width: 22px;
        height: 22px;
      }

      .event-dot {
        width: 4px;
        height: 4px;
      }

      .event-label {
        font-size: 6px;
      }

      .header-btn {
        width: 38px;
        height: 38px;
      }

      .schedule-type-btn {
        width: 40px;
        height: 40px;
      }
    }

    @media (min-width: 431px) {
      /* –ë–æ–ª—å—à–∏–µ —ç–∫—Ä–∞–Ω—ã (iPhone 14 Pro Max+, Galaxy Ultra) */
      .glass-panel {
        padding: 24px !important;
      }

      .btn-gold,
      .btn-secondary {
        min-height: 56px;
      }

      .header-btn {
        width: 52px;
        height: 52px;
      }

      .schedule-type-btn {
        width: 48px;
        height: 48px;
      }
    }

    /* Landscape orientation warning for very small screens */
    @media (max-height: 500px) and (orientation: landscape) {
      body::before {
        content: '';
        position: fixed;
        inset: 0;
        background: rgba(5,5,7,0.95);
        z-index: 99998;
        backdrop-filter: blur(10px);
      }
      
      body::after {
        content: 'üì± –ü–æ–≤–µ—Ä–Ω–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ';
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 99999;
        color: #f59e0b;
        font-size: 18px;
        font-weight: 800;
        text-align: center;
        font-family: 'Cinzel', serif;
        text-shadow: 0 0 30px rgba(245,158,11,0.5);
      }
    }

    /* MAGIC HAT CELEBRATION */
    #celebration-container {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 10001;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s;
    }

    #celebration-container.show {
      opacity: 1;
    }

    .magic-hat {
      position: relative;
      width: 120px;
      height: 120px;
      transform: scale(0) rotateY(180deg);
      transition: transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .magic-hat.show {
      transform: scale(1) rotateY(0deg);
    }

    /* Hat Top (cylinder) */
    .hat-top {
      position: absolute;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 90px;
      background: linear-gradient(180deg, #1a1a1a 0%, #000 100%);
      border-radius: 10px 10px 0 0;
      border: 3px solid #2a2a2a;
      box-shadow: 
        0 -5px 20px rgba(0,0,0,0.8),
        inset 0 2px 10px rgba(255,255,255,0.1);
    }

    .hat-top::before {
      content: '';
      position: absolute;
      top: 10px;
      left: 10%;
      width: 30%;
      height: 40%;
      background: linear-gradient(135deg, rgba(255,255,255,0.2), transparent);
      border-radius: 50%;
      filter: blur(8px);
    }

    /* Hat Brim */
    .hat-brim {
      position: absolute;
      bottom: 70px;
      left: 50%;
      transform: translateX(-50%);
      width: 180px;
      height: 40px;
      background: linear-gradient(180deg, #1a1a1a 0%, #000 50%, #0a0a0a 100%);
      border-radius: 50%;
      border: 3px solid #2a2a2a;
      box-shadow: 
        0 10px 40px rgba(0,0,0,0.9),
        inset 0 -5px 15px rgba(0,0,0,0.5),
        inset 0 2px 10px rgba(255,255,255,0.1);
    }

    .hat-brim::after {
      content: '';
      position: absolute;
      inset: 8px;
      background: radial-gradient(ellipse at center, rgba(245,158,11,0.1), transparent 70%);
      border-radius: 50%;
    }

    /* Gold Ribbon */
    .hat-ribbon {
      position: absolute;
      bottom: 78px;
      left: 50%;
      transform: translateX(-50%);
      width: 110px;
      height: 15px;
      background: linear-gradient(90deg, #ea580c, #f59e0b, #fb923c, #ea580c);
      background-size: 200% 100%;
      border-radius: 3px;
      box-shadow: 
        0 2px 8px rgba(245,158,11,0.6),
        inset 0 1px 2px rgba(255,255,255,0.3);
      animation: ribbonShine 2s linear infinite;
    }

    @keyframes ribbonShine {
      0% { background-position: 200% center; }
      100% { background-position: -200% center; }
    }

    /* Sparkle particles */
    .sparkle {
      position: absolute;
      width: 8px;
      height: 8px;
      background: radial-gradient(circle, #fff, #f59e0b);
      border-radius: 50%;
      box-shadow: 
        0 0 10px #f59e0b,
        0 0 20px #f59e0b,
        0 0 30px rgba(245,158,11,0.5);
      animation: sparkleFountain linear forwards;
      pointer-events: none;
    }

    @keyframes sparkleFountain {
      0% {
        transform: translate(0, 0) scale(1);
        opacity: 1;
      }
      100% {
        transform: translate(var(--tx), var(--ty)) scale(0);
        opacity: 0;
      }
    }

    /* Star particles */
    .star-particle {
      position: absolute;
      font-size: 20px;
      animation: starFountain linear forwards;
      filter: drop-shadow(0 0 8px currentColor);
    }

    @keyframes starFountain {
      0% {
        transform: translate(0, 0) rotate(0deg) scale(0);
        opacity: 1;
      }
      50% {
        opacity: 1;
        transform: translate(var(--tx), var(--ty)) rotate(var(--rotate)) scale(1);
      }
      100% {
        transform: translate(var(--tx), calc(var(--ty) + 50px)) rotate(var(--rotate)) scale(0.5);
        opacity: 0;
      }
    }

    /* Goal message */
    .goal-message {
      position: absolute;
      top: 20%;
      left: 50%;
      transform: translateX(-50%) translateY(50px);
      text-align: center;
      opacity: 0;
      transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
      padding: 24px 36px;
      background: linear-gradient(135deg, rgba(0,0,0,0.85) 0%, rgba(10,10,14,0.9) 100%);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 24px;
      border: 2px solid rgba(245,158,11,0.4);
      box-shadow: 
        0 20px 60px rgba(0,0,0,0.8),
        0 0 80px rgba(245,158,11,0.3),
        inset 0 1px 0 rgba(255,255,255,0.1);
    }

    .goal-message::before {
      content: '';
      position: absolute;
      inset: -2px;
      background: linear-gradient(135deg, transparent, rgba(245,158,11,0.2), transparent);
      border-radius: 24px;
      z-index: -1;
      animation: borderGlow 3s linear infinite;
    }

    @keyframes borderGlow {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    .goal-message.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    .goal-message-title {
      font-family: 'Cinzel', serif;
      font-size: 32px;
      font-weight: 900;
      background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 25%, #f59e0b 50%, #fbbf24 75%, #f59e0b 100%);
      background-size: 200% 100%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: goldShimmer 3s linear infinite;
      filter: drop-shadow(0 4px 12px rgba(245,158,11,0.8)) drop-shadow(0 0 40px rgba(245,158,11,0.6));
      margin-bottom: 12px;
      letter-spacing: 0.05em;
      text-shadow: none;
    }

    @keyframes goldShimmer {
      0% { background-position: 200% center; }
      100% { background-position: -200% center; }
    }

    .goal-message-subtitle {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
      text-shadow:
        0 0 30px rgba(245,158,11,1),
        0 4px 8px rgba(0,0,0,0.8),
        0 0 15px rgba(245,158,11,0.8);
      animation: subtitlePulse 2s ease-in-out infinite;
      letter-spacing: 0.08em;
    }

    @keyframes subtitlePulse {
      0%, 100% { 
        transform: scale(1);
        filter: drop-shadow(0 0 20px rgba(245,158,11,0.8));
      }
      50% { 
        transform: scale(1.05);
        filter: drop-shadow(0 0 30px rgba(245,158,11,1));
      }
    }

    /* Magic glow around hat */
    .magic-glow {
      position: absolute;
      inset: -40px;
      background: radial-gradient(ellipse at center, rgba(245,158,11,0.3), transparent 70%);
      border-radius: 50%;
      animation: glowPulse 2s ease-in-out infinite;
    }

    @keyframes glowPulse {
      0%, 100% { 
        transform: scale(1);
        opacity: 0.5;
      }
      50% { 
        transform: scale(1.2);
        opacity: 0.8;
      }
    }

    /* SPLASH SCREEN */
    #splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100vw;
      height: 100vh;
      height: 100dvh;
      z-index: 99999;
      background: linear-gradient(180deg, #050507 0%, #0a0a0e 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 1;
      transition: opacity 0.6s ease-out;
      overflow: hidden;
    }

    #splash-screen.hide {
      opacity: 0;
      pointer-events: none;
    }

    .splash-icon {
      width: 120px;
      height: 120px;
      border-radius: 28px;
      position: relative;
      background: linear-gradient(135deg, rgba(245,158,11,0.12), rgba(245,158,11,0.06));
      border: 2px solid rgba(245,158,11,0.2);
      box-shadow:
        0 20px 60px rgba(0,0,0,0.6),
        0 8px 20px rgba(245,158,11,0.1),
        inset 0 1px 0 rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 40px;
    }

    .splash-icon i,
    .splash-icon svg {
      position: relative;
      z-index: 10;
      width: 64px;
      height: 64px;
      color: #f59e0b;
      filter: drop-shadow(0 4px 12px rgba(245,158,11,0.3));
    }

    .splash-title {
      font-family: 'Cinzel', serif;
      font-size: 32px;
      font-weight: 900;
      background: linear-gradient(135deg, #f59e0b, #f59e0b, #f59e0b);
      background-size: 200% 100%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 12px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      animation: titleShimmer 3s linear infinite;
    }

    @keyframes titleShimmer {
      0% { background-position: 200% center; }
      100% { background-position: -200% center; }
    }

    .splash-subtitle {
      font-size: 15px;
      font-weight: 700;
      color: rgba(245,158,11,0.7);
      letter-spacing: 0.15em;
      text-transform: uppercase;
      margin-bottom: 32px;
    }

    .splash-tagline {
      font-size: 14px;
      font-weight: 400;
      color: rgba(148,163,184,0.6);
      font-style: italic;
      letter-spacing: 0.05em;
    }

    .splash-loader {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(245,158,11,0.1);
      border-top-color: #f59e0b;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-top: 40px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- PARTICLES CANVAS -->

  <!-- SPLASH SCREEN -->
  <div id="splash-screen">
    <div class="splash-icon">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 64px; height: 64px;">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
        <circle cx="8" cy="14" r="0.8" fill="currentColor"></circle>
        <circle cx="12" cy="14" r="0.8" fill="currentColor"></circle>
        <circle cx="16" cy="14" r="0.8" fill="currentColor"></circle>
        <circle cx="8" cy="18" r="0.8" fill="currentColor"></circle>
        <circle cx="12" cy="18" r="0.8" fill="currentColor"></circle>
        <circle cx="16" cy="18" r="0.8" fill="currentColor"></circle>
      </svg>
    </div>
    <div class="splash-title">Illusionist OS</div>
    <div class="splash-subtitle">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</div>
    <div class="splash-tagline">–í—Ä–µ–º—è ‚Äî —ç—Ç–æ –∏–ª–ª—é–∑–∏—è</div>
    <div class="splash-loader"></div>
  </div>

  <!-- MAGIC HAT CELEBRATION -->
  <div id="celebration-container">
    <div class="magic-hat" id="magic-hat">
      <div class="magic-glow"></div>
      <div class="hat-top"></div>
      <div class="hat-ribbon"></div>
      <div class="hat-brim"></div>
    </div>
    <div class="goal-message" id="goal-message">
      <div class="goal-message-title">üé© –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê! üé©</div>
      <div class="goal-message-subtitle">–ë—Ä–∞–≤–æ, –ú–∞—ç—Å—Ç—Ä–æ!</div>
    </div>
  </div>

  <!-- HEADER -->
  <header style="position: fixed; top: 0; left: 0; right: 0; z-index: 50; background: #000; padding: 16px 20px; padding-top: calc(16px + var(--safe-top)); padding-left: max(20px, var(--safe-left)); padding-right: max(20px, var(--safe-right));">
    <div style="display: flex; align-items: center; justify-content: space-between;">
      <div style="display: flex; align-items: center; gap: 16px;">
        <div style="width: 48px; height: 48px; border-radius: 16px; background: rgba(255,255,255,.10); border: 1px solid rgba(255,255,255,.15); display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 24px rgba(0,0,0,0.2);">
          <i data-lucide="calendar-days" style="width: 24px; height: 24px; color: rgba(245,158,11,.95);"></i>
        </div>
        <div>
          <div style="font-family: Georgia, 'Palatino Linotype', 'Book Antiqua', Palatino, 'Times New Roman', serif; font-weight: 600; letter-spacing: 0.05em; color: #fff; font-size: 18px;">Illusionist OS</div>
          <div style="font-size: 14px; color: #94a3b8; font-weight: 600;">–£–º–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å</div>
        </div>
      </div>

      <button class="header-btn" onclick="openSettingsModal()" style="width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 16px; background: rgba(255,255,255,.08); border: 1.5px solid rgba(255,255,255,.12);">
        <i data-lucide="settings" style="width: 24px; height: 24px; color: #e2e8f0;"></i>
      </button>
    </div>
  </header>

  <!-- CALENDAR TAB -->
  <div id="calendar-tab" class="tab-content active" style="padding-top: calc(68px + var(--safe-top)); padding-bottom: calc(92px + env(safe-area-inset-bottom, 0px)); display: flex; flex-direction: column;">
    <div style="padding: 10px 18px; background: linear-gradient(135deg, rgba(245,158,11,0.08), rgba(245,158,11,0.04)); border-bottom: 1px solid rgba(245,158,11,0.15); flex-shrink: 0;">
      <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px;">
        <button class="header-btn" onclick="changeMonth(-1)" style="margin: 0;">
          <i data-lucide="chevron-left"></i>
        </button>

        <h1 class="month-title" id="month-title" onclick="openMonthPicker()" style="cursor: pointer; margin: 0;">–Ø–Ω–≤–∞—Ä—å 2026</h1>

        <button class="header-btn" onclick="changeMonth(1)" style="margin: 0;">
          <i data-lucide="chevron-right"></i>
        </button>
      </div>
    </div>

    <div style="margin: 12px; margin-top: 8px; margin-bottom: 4px; flex: 1; display: flex; flex-direction: column; overflow: hidden;">
      <div class="calendar-container">
        <div class="day-headers">
          <div class="day-header">–ü–Ω</div>
          <div class="day-header">–í—Ç</div>
          <div class="day-header">–°—Ä</div>
          <div class="day-header">–ß—Ç</div>
          <div class="day-header">–ü—Ç</div>
          <div class="day-header">–°–±</div>
          <div class="day-header">–í—Å</div>
        </div>

        <div class="calendar-grid" id="calendar-grid"></div>

        <div class="day-list" id="day-list" style="padding-bottom: 20px;"></div>
      </div>
    </div>
  </div>

  <!-- DASHBOARD TAB -->
  <div id="dashboard-tab" class="tab-content" style="padding-top: calc(82px + var(--safe-top)); background: #000;">
    <div class="dashboard-container" style="background: #000;">
      <!-- PROFIT CARD -->
      <div class="glass-panel" style="padding: 24px; margin-bottom: 20px;">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
          <i data-lucide="coins" style="width: 24px; height: 24px; color: #f59e0b;"></i>
          <h3 style="font-size: 13px; font-weight: 800; color: rgba(245,158,11,0.9); text-transform: uppercase; letter-spacing: 0.1em;">–§–∏–Ω–∞–Ω—Å—ã –º–µ—Å—è—Ü–∞</h3>
        </div>

        <div style="text-align: center; margin-bottom: 24px;">
          <div style="font-size: 42px; font-weight: 900; background: linear-gradient(135deg, #f59e0b, #fb923c); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-family: 'Cinzel', serif;" id="profit-amount">0 ‚ÇΩ</div>
          <div style="font-size: 12px; color: rgba(148,163,184,.8); text-transform: uppercase; font-weight: 700; margin-top: 6px; letter-spacing: 0.08em;">–ü—Ä–∏–±—ã–ª—å (–¥–æ—Ö–æ–¥ ‚àí —Ä–∞—Å—Ö–æ–¥)</div>
        </div>

        <!-- GOAL PROGRESS -->
        <div style="margin-bottom: 24px;">
          <div style="height: 10px; background: rgba(0,0,0,.4); border-radius: 999px; overflow: hidden; border: 1px solid rgba(245,158,11,0.15);">
            <div id="goal-progress" style="height: 100%; background: linear-gradient(90deg, #f59e0b, #fb923c); width: 0%; transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 0 12px rgba(245,158,11,0.5);"></div>
          </div>
          <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 12px;">
            <span style="color: rgba(148,163,184,.8); font-weight: 600;" id="goal-text">–¶–µ–ª—å: 200,000 ‚ÇΩ</span>
            <span style="color: #f59e0b; font-weight: 800;" id="goal-percent">0%</span>
          </div>
        </div>

        <!-- KPI GRID -->
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px;">
          <div style="background: linear-gradient(135deg, rgba(52,211,153,0.08), rgba(52,211,153,0.03)); border: 1px solid rgba(52,211,153,0.15); border-radius: 14px; padding: 14px;">
            <div style="font-size: 11px; color: rgba(52,211,153,0.8); text-transform: uppercase; font-weight: 800; margin-bottom: 6px; letter-spacing: 0.05em;">–î–æ—Ö–æ–¥</div>
            <div style="font-size: 18px; font-weight: 900; color: #34d399; font-family: 'JetBrains Mono', monospace;" id="kpi-income">0 ‚ÇΩ</div>
          </div>
          <div style="background: linear-gradient(135deg, rgba(239,68,68,0.08), rgba(239,68,68,0.03)); border: 1px solid rgba(239,68,68,0.15); border-radius: 14px; padding: 14px;">
            <div style="font-size: 11px; color: rgba(239,68,68,0.8); text-transform: uppercase; font-weight: 800; margin-bottom: 6px; letter-spacing: 0.05em;">–†–∞—Å—Ö–æ–¥</div>
            <div style="font-size: 18px; font-weight: 900; color: #ef4444; font-family: 'JetBrains Mono', monospace;" id="kpi-expense">0 ‚ÇΩ</div>
          </div>
          <div style="background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02)); border: 1px solid rgba(245,158,11,0.12); border-radius: 14px; padding: 14px;">
            <div style="font-size: 11px; color: rgba(245,158,11,0.7); text-transform: uppercase; font-weight: 800; margin-bottom: 6px; letter-spacing: 0.05em;">–®–æ—É (—à—Ç)</div>
            <div style="font-size: 18px; font-weight: 900; color: #fff; font-family: 'JetBrains Mono', monospace;" id="kpi-shows">0</div>
          </div>
          <div style="background: linear-gradient(135deg, rgba(245,158,11,0.08), rgba(245,158,11,0.03)); border: 1px solid rgba(245,158,11,0.2); border-radius: 14px; padding: 14px;">
            <div style="font-size: 11px; color: rgba(245,158,11,0.8); text-transform: uppercase; font-weight: 800; margin-bottom: 6px; letter-spacing: 0.05em;">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</div>
            <div style="font-size: 18px; font-weight: 900; color: #f59e0b; font-family: 'JetBrains Mono', monospace;" id="kpi-avg">0 ‚ÇΩ</div>
          </div>
          <div style="background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(245,158,11,0.04)); border: 1px solid rgba(245,158,11,0.25); border-radius: 14px; padding: 14px;">
            <div style="font-size: 11px; color: rgba(245,158,11,0.8); text-transform: uppercase; font-weight: 800; margin-bottom: 6px; letter-spacing: 0.05em;">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</div>
            <div style="font-size: 18px; font-weight: 900; color: #f59e0b; font-family: 'JetBrains Mono', monospace;" id="kpi-balance">0 ‚ÇΩ</div>
          </div>
          <div style="background: linear-gradient(135deg, rgba(239,68,68,0.08), rgba(239,68,68,0.03)); border: 1px solid rgba(239,68,68,0.15); border-radius: 14px; padding: 14px;">
            <div style="font-size: 11px; color: rgba(239,68,68,0.8); text-transform: uppercase; font-weight: 800; margin-bottom: 6px; letter-spacing: 0.05em;">–ù–∞–ª–æ–≥–∏</div>
            <div style="font-size: 18px; font-weight: 900; color: #ef4444; font-family: 'JetBrains Mono', monospace;" id="kpi-tax">0 ‚ÇΩ</div>
          </div>
        </div>

        <!-- INSIGHTS -->
        <div style="border-top: 1px solid rgba(245,158,11,0.1); padding-top: 20px;">
          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 14px;">
            <i data-lucide="sparkles" style="width: 18px; height: 18px; color: #f59e0b;"></i>
            <div style="font-size: 12px; color: rgba(245,158,11,0.8); text-transform: uppercase; font-weight: 800; letter-spacing: 0.08em;">–ò–Ω—Å–∞–π—Ç—ã</div>
          </div>
          <div id="insights-list" style="display: flex; flex-direction: column; gap: 10px; font-size: 14px; color: rgba(226,232,240,.95); line-height: 1.5;">
            <!-- Generated by JS -->
          </div>
        </div>
      </div>

      <!-- TYPES ANALYTICS -->
      <div class="glass-panel" style="padding: 24px; margin-bottom: 20px;">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
          <i data-lucide="bar-chart-3" style="width: 24px; height: 24px; color: #f59e0b;"></i>
          <h3 style="font-size: 13px; font-weight: 800; color: rgba(245,158,11,0.9); text-transform: uppercase; letter-spacing: 0.1em;">–¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π</h3>
        </div>

        <div id="types-list" style="display: flex; flex-direction: column; gap: 12px;">
          <!-- Generated by JS -->
        </div>

        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(245,158,11,0.1);">
          <div style="background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02)); border: 1px solid rgba(245,158,11,0.12); border-radius: 14px; padding: 14px;">
            <div style="font-size: 11px; color: rgba(245,158,11,0.7); text-transform: uppercase; font-weight: 800; margin-bottom: 6px; letter-spacing: 0.05em;">–¢–æ–ø —Ç–∏–ø</div>
            <div style="font-size: 16px; font-weight: 900; color: #fff;" id="kpi-top-type">‚Äî</div>
          </div>
          <div style="background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02)); border: 1px solid rgba(245,158,11,0.12); border-radius: 14px; padding: 14px;">
            <div style="font-size: 11px; color: rgba(245,158,11,0.7); text-transform: uppercase; font-weight: 800; margin-bottom: 6px; letter-spacing: 0.05em;">–õ—É—á—à–∏–π –¥–µ–Ω—å</div>
            <div style="font-size: 16px; font-weight: 900; color: #fff;" id="kpi-best-day">‚Äî</div>
          </div>
        </div>
      </div>

      <!-- UPCOMING EVENTS -->
      <div class="glass-panel" style="padding: 24px;">
        <div class="day-list-header" style="margin-bottom: 16px;">
          –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è
        </div>
        <div id="dashboard-list">
          <!-- Generated by JS -->
        </div>
      </div>
    </div>
  </div>

  <!-- BOTTOM NAV -->
  <div id="bottom-nav">
    <div class="nav-inner">
      <button class="nav-item active" onclick="switchTab('calendar')">
        <i data-lucide="calendar"></i>
      </button>

      <button class="nav-item" onclick="openEventModal()">
        <i data-lucide="plus"></i>
      </button>

      <button class="nav-item" onclick="switchTab('dashboard')">
        <i data-lucide="bar-chart-3"></i>
      </button>
    </div>
  </div>

  <!-- EVENT MODAL -->
  <div id="event-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="modal-title">–ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ</h2>
        <button class="modal-close" onclick="closeEventModal()">
          <i data-lucide="x"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="modal-tabs">
          <button class="modal-tab active" onclick="switchModalTab('info', event)">–ò–Ω—Ñ–æ</button>
          <button class="modal-tab" onclick="switchModalTab('schedule', event)">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</button>
          <button class="modal-tab" onclick="switchModalTab('finance', event)">–§–∏–Ω–∞–Ω—Å—ã</button>
        </div>

        <!-- INFO TAB -->
        <div id="tab-info" class="tab-panel active">
          <div class="form-group">
            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</label>
            <input type="text" id="event-title" class="form-input" placeholder="–Æ–±–∏–ª–µ–π 50 –ª–µ—Ç">
          </div>

          <div class="form-group">
            <label class="form-label">–î–∞—Ç–∞</label>
            <input type="date" id="event-date" class="form-input">
          </div>

          <div class="form-group">
            <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
            <select id="event-status" class="form-select">
              <option value="pending">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –±—Ä–æ–Ω—å</option>
              <option value="confirmed">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</option>
              <option value="completed">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">–õ–æ–∫–∞—Ü–∏—è</label>
            <input type="text" id="event-location" class="form-input" placeholder="–†–µ—Å—Ç–æ—Ä–∞–Ω XYZ">
          </div>

          <div class="form-group">
            <label class="form-label">–ê–¥—Ä–µ—Å</label>
            <input type="text" id="event-address" class="form-input" placeholder="–ú–æ—Å–∫–≤–∞, —É–ª. –ü—É—à–∫–∏–Ω–∞, –¥. 10">
          </div>

          <div class="form-group">
            <label class="form-label">–ö–ª–∏–µ–Ω—Ç</label>
            <input type="text" id="event-client" class="form-input" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
          </div>

          <div class="form-group">
            <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input type="tel" id="event-phone" class="form-input" placeholder="+7 900 123-45-67">
          </div>

          <div class="form-group">
            <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π</label>
            <input type="number" id="event-guests" class="form-input" placeholder="0" min="0">
          </div>

          <div class="form-group">
            <label class="form-label">–ó–∞–º–µ—Ç–∫–∏</label>
            <textarea id="event-notes" class="form-textarea" placeholder="–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏..."></textarea>
          </div>
        </div>

        <!-- SCHEDULE TAB -->
        <div id="tab-schedule" class="tab-panel">
          <div class="schedule-section">
            <div class="schedule-header">
              <div class="schedule-title">–í—ã—Ö–æ–¥—ã</div>
              <button class="schedule-add" onclick="addScheduleItem()">
                <i data-lucide="plus"></i>
                <span>–î–æ–±–∞–≤–∏—Ç—å</span>
              </button>
            </div>

            <div class="schedule-list" id="schedule-list"></div>
          </div>
        </div>

        <!-- FINANCE TAB -->
        <div id="tab-finance" class="tab-panel">
          <div class="form-group">
            <label class="form-label">–î–æ—Ö–æ–¥</label>
            <input type="number" id="event-income" class="form-input" placeholder="0" oninput="calculateBalance()">
          </div>

          <div class="form-group">
            <label class="form-label">–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞</label>
            <input type="number" id="event-prepay" class="form-input" placeholder="0" oninput="calculateBalance()">
          </div>

          <div class="form-group">
            <label class="form-label">–†–∞—Å—Ö–æ–¥—ã</label>
            <input type="number" id="event-expense" class="form-input" placeholder="0" oninput="calculateBalance()">
          </div>

          <div class="form-group">
            <label class="form-label">–ù–∞–ª–æ–≥ (%)</label>
            <input type="number" id="event-tax" class="form-input" placeholder="0" min="0" max="100" oninput="calculateBalance()">
          </div>

          <div class="balance-group">
            <div class="balance-label">–û—Å—Ç–∞—Ç–æ–∫ –∫ –ø–æ–ª—É—á–µ–Ω–∏—é</div>
            <div class="balance-value" id="balance-display">0 ‚ÇΩ</div>
          </div>
        </div>

        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
          <button class="btn-primary" onclick="saveEvent()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button class="btn-secondary" onclick="closeEventModal()">–û—Ç–º–µ–Ω–∞</button>
          <button class="btn-danger" id="delete-btn" onclick="deleteEvent()" style="display: none;">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>

  <!-- SETTINGS MODAL -->
  <div id="settings-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">
          <i data-lucide="settings" style="width: 24px; height: 24px; display: inline-block; vertical-align: middle; margin-right: 10px;"></i>
          –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        </h2>
        <button class="modal-close" onclick="closeSettingsModal()">
          <i data-lucide="x"></i>
        </button>
      </div>

      <div class="modal-body">
        <!-- GOAL SETTING -->
        <div class="glass-panel" style="padding: 20px; margin-bottom: 20px;">
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px;">
            <i data-lucide="target" style="width: 20px; height: 20px; color: #f59e0b;"></i>
            <div style="font-size: 12px; color: rgba(245,158,11,0.8); text-transform: uppercase; font-weight: 800; letter-spacing: 0.08em;">–¶–µ–ª—å –º–µ—Å—è—Ü–∞</div>
          </div>
          <input type="number" id="goal-input" class="form-input" placeholder="200000" style="margin-bottom: 12px;">
          <button onclick="saveGoal()" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–ª—å</button>
        </div>

        <!-- CUSTOM TYPES -->
        <div class="glass-panel" style="padding: 20px; margin-bottom: 20px;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
            <div style="display: flex; align-items: center; gap: 10px;">
              <i data-lucide="shapes" style="width: 20px; height: 20px; color: #f59e0b;"></i>
              <div style="font-size: 12px; color: rgba(245,158,11,0.8); text-transform: uppercase; font-weight: 800; letter-spacing: 0.08em;">–¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π</div>
            </div>
            <button onclick="openTypeEditor()" style="padding: 8px 14px; background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(245,158,11,0.08)); border: 1px solid rgba(245,158,11,0.25); border-radius: 10px; color: #f59e0b; font-size: 11px; font-weight: 800; cursor: pointer; display: flex; align-items: center; gap: 6px; text-transform: uppercase; letter-spacing: 0.05em;">
              <i data-lucide="plus" style="width: 14px; height: 14px;"></i>
              <span>–î–æ–±–∞–≤–∏—Ç—å</span>
            </button>
          </div>
          
          <div id="custom-types-list" style="display: flex; flex-direction: column; gap: 10px;">
            <!-- Generated by JS -->
          </div>
        </div>

        <!-- EXPORT/IMPORT -->
        <div class="glass-panel" style="padding: 20px; margin-bottom: 20px;">
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px;">
            <i data-lucide="database" style="width: 20px; height: 20px; color: #f59e0b;"></i>
            <div style="font-size: 12px; color: rgba(245,158,11,0.8); text-transform: uppercase; font-weight: 800; letter-spacing: 0.08em;">–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏</div>
          </div>
          <button onclick="exportData()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, rgba(52,211,153,0.15), rgba(52,211,153,0.08)); border: 1px solid rgba(52,211,153,0.25); border-radius: 12px; color: #34d399; font-weight: 800; cursor: pointer; margin-bottom: 12px; display: flex; align-items: center; justify-content: center; gap: 8px; text-transform: uppercase; font-size: 13px; letter-spacing: 0.05em; transition: all 0.3s;">
            <i data-lucide="download" style="width: 18px; height: 18px;"></i>
            –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
          </button>
          <label style="display: block; width: 100%; padding: 14px; background: linear-gradient(135deg, rgba(96,165,250,0.15), rgba(96,165,250,0.08)); border: 1px solid rgba(96,165,250,0.25); border-radius: 12px; color: #60a5fa; font-weight: 800; cursor: pointer; text-align: center; text-transform: uppercase; font-size: 13px; letter-spacing: 0.05em; transition: all 0.3s;">
            <i data-lucide="upload" style="width: 18px; height: 18px; display: inline-block; vertical-align: middle; margin-right: 8px;"></i>
            –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
            <input type="file" id="import-file" accept="application/json" onchange="importData(this)" style="display: none;">
          </label>
        </div>

        <!-- RESET -->
        <div class="glass-panel" style="padding: 20px;">
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px;">
            <i data-lucide="trash-2" style="width: 20px; height: 20px; color: #ef4444;"></i>
            <div style="font-size: 12px; color: rgba(239,68,68,0.8); text-transform: uppercase; font-weight: 800; letter-spacing: 0.08em;">–û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</div>
          </div>
          <button onclick="resetData()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, rgba(239,68,68,0.15), rgba(239,68,68,0.08)); border: 1px solid rgba(239,68,68,0.3); border-radius: 12px; color: #ef4444; font-weight: 800; cursor: pointer; text-transform: uppercase; font-size: 13px; letter-spacing: 0.05em; transition: all 0.3s; margin-bottom: 12px;">
            <i data-lucide="alert-triangle" style="width: 18px; height: 18px; display: inline-block; vertical-align: middle; margin-right: 8px;"></i>
            –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
          </button>
          <button onclick="resetCelebrations()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(245,158,11,0.08)); border: 1px solid rgba(245,158,11,0.25); border-radius: 12px; color: #f59e0b; font-weight: 800; cursor: pointer; text-transform: uppercase; font-size: 13px; letter-spacing: 0.05em; transition: all 0.3s;">
            <i data-lucide="sparkles" style="width: 18px; height: 18px; display: inline-block; vertical-align: middle; margin-right: 8px;"></i>
            –°–±—Ä–æ—Å–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- MONTH PICKER MODAL -->
  <div id="month-picker-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">–í—ã–±–æ—Ä –º–µ—Å—è—Ü–∞</h2>
        <button class="modal-close" onclick="closeMonthPicker()">
          <i data-lucide="x"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="year-selector">
          <button class="year-btn" onclick="changePickerYear(-1)">
            <i data-lucide="chevron-left"></i>
          </button>
          <div class="year-display" id="picker-year">2026</div>
          <button class="year-btn" onclick="changePickerYear(1)">
            <i data-lucide="chevron-right"></i>
          </button>
        </div>

        <div class="month-grid">
          <button class="month-btn" onclick="selectMonth(0)">–Ø–Ω–≤</button>
          <button class="month-btn" onclick="selectMonth(1)">–§–µ–≤</button>
          <button class="month-btn" onclick="selectMonth(2)">–ú–∞—Ä</button>
          <button class="month-btn" onclick="selectMonth(3)">–ê–ø—Ä</button>
          <button class="month-btn" onclick="selectMonth(4)">–ú–∞–π</button>
          <button class="month-btn" onclick="selectMonth(5)">–ò—é–Ω</button>
          <button class="month-btn" onclick="selectMonth(6)">–ò—é–ª</button>
          <button class="month-btn" onclick="selectMonth(7)">–ê–≤–≥</button>
          <button class="month-btn" onclick="selectMonth(8)">–°–µ–Ω</button>
          <button class="month-btn" onclick="selectMonth(9)">–û–∫—Ç</button>
          <button class="month-btn" onclick="selectMonth(10)">–ù–æ—è</button>
          <button class="month-btn" onclick="selectMonth(11)">–î–µ–∫</button>
        </div>
      </div>
    </div>
  </div>

  <!-- TYPE EDITOR MODAL -->
  <div id="type-editor-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="type-editor-title">–ù–æ–≤—ã–π —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è</h2>
        <button class="modal-close" onclick="closeTypeEditor()">
          <i data-lucide="x"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–ø–∞</label>
          <input type="text" id="type-name" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤">
        </div>

        <div class="form-group">
          <label class="form-label">–¶–≤–µ—Ç</label>
          <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px;">
            <button class="color-btn" data-color="#f59e0b" onclick="selectColor('#f59e0b')" style="background: #f59e0b;"></button>
            <button class="color-btn" data-color="#c084fc" onclick="selectColor('#c084fc')" style="background: #c084fc;"></button>
            <button class="color-btn" data-color="#34d399" onclick="selectColor('#34d399')" style="background: #34d399;"></button>
            <button class="color-btn" data-color="#60a5fa" onclick="selectColor('#60a5fa')" style="background: #60a5fa;"></button>
            <button class="color-btn" data-color="#ef4444" onclick="selectColor('#ef4444')" style="background: #ef4444;"></button>
            <button class="color-btn" data-color="#f59e0b" onclick="selectColor('#f59e0b')" style="background: #f59e0b;"></button>
            <button class="color-btn" data-color="#ec4899" onclick="selectColor('#ec4899')" style="background: #ec4899;"></button>
            <button class="color-btn" data-color="#8b5cf6" onclick="selectColor('#8b5cf6')" style="background: #8b5cf6;"></button>
            <button class="color-btn" data-color="#10b981" onclick="selectColor('#10b981')" style="background: #10b981;"></button>
            <button class="color-btn" data-color="#3b82f6" onclick="selectColor('#3b82f6')" style="background: #3b82f6;"></button>
            <button class="color-btn" data-color="#cbd5e1" onclick="selectColor('#cbd5e1')" style="background: #cbd5e1;"></button>
            <button class="color-btn" data-color="#64748b" onclick="selectColor('#64748b')" style="background: #64748b;"></button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">–ò–∫–æ–Ω–∫–∞</label>
          <div id="icon-grid" style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; max-height: 300px; overflow-y: auto; padding: 4px;">
            <!-- Icons will be generated by JS -->
          </div>
        </div>

        <button onclick="saveCustomType()" class="btn-primary" style="margin-bottom: 12px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button onclick="closeTypeEditor()" class="btn-secondary" style="margin-bottom: 12px;">–û—Ç–º–µ–Ω–∞</button>
        <button id="delete-type-btn" onclick="deleteCustomType()" class="btn-danger" style="display: none; margin-top: 20px;">–£–¥–∞–ª–∏—Ç—å —Ç–∏–ø</button>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div id="toast">
    <span id="toast-msg"></span>
  </div>

  <!-- CONFIRM MODAL -->
  <div id="confirm-modal" class="modal-overlay">
    <div class="modal-content" style="max-width: 400px;">
      <div class="modal-header">
        <h2 class="modal-title" id="confirm-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h2>
      </div>
      <div class="modal-body">
        <p id="confirm-message" style="color: rgba(255,255,255,0.8); font-size: 15px; line-height: 1.6;"></p>
        <div style="display: flex; gap: 12px; margin-top: 24px;">
          <button id="confirm-yes" class="btn-danger" style="flex: 1;">–£–¥–∞–ª–∏—Ç—å</button>
          <button id="confirm-no" class="btn-secondary" style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==========================================
    // PARTICLES
    // ==========================================
    // Particles disabled for cleaner design

    // ==========================================
    // DATA
    // ==========================================
    // Available icons for selection
    const AVAILABLE_ICONS = [
      'rabbit', 'wand-2', 'spade', 'club', 'diamond', 'sparkles', 'mic', 'dice-5',
      'baby', 'alert-circle', 'cylinder', 'users', 'briefcase',
      'clock', 'wallet', 'drama', 'box', 'music',
      'coins', 'brain', 'lock', 'user'
    ];

    // Default types
    const DEFAULT_TYPES = {
      rabbit: { label: '–ö—Ä–æ–ª–∏–∫', color: '#f59e0b', icon: 'rabbit' },
      wand: { label: '–í–æ–ª—à–µ–±—Å—Ç–≤–æ', color: '#c084fc', icon: 'wand-2' },
      cards: { label: '–ö–∞—Ä—Ç—ã', color: '#ef4444', icon: 'spade' },
      spades: { label: '–ü–∏–∫–∏ ‚ô†', color: '#1e293b', icon: 'spade' },
      clubs: { label: '–ö—Ä–µ—Å—Ç–∏ ‚ô£', color: '#0f172a', icon: 'club' },
      diamonds: { label: '–ë—É–±–Ω—ã ‚ô¶', color: '#ef4444', icon: 'diamond' },
      wow: { label: '–í–∞—É', color: '#fbbf24', icon: 'sparkles' },
      microphone: { label: '–ú–∏–∫—Ä–æ—Ñ–æ–Ω', color: '#60a5fa', icon: 'mic' },
      dice: { label: '–ò–≥—Ä–∞', color: '#34d399', icon: 'dice-5' },
      baby: { label: '–î–µ—Ç—Å–∫–æ–µ', color: '#fb923c', icon: 'baby' },
      alert: { label: '–í–∞–∂–Ω–æ', color: '#ef4444', icon: 'alert-circle' },
      hat: { label: '–®–ª—è–ø–∞', color: '#a855f7', icon: 'cylinder' },
      family: { label: '–°–µ–º—å—è', color: '#22c55e', icon: 'users' },
      tie: { label: '–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤', color: '#3b82f6', icon: 'briefcase' },
      time: { label: '–í—Ä–µ–º—è', color: '#94a3b8', icon: 'clock' },
      money: { label: '–î–µ–Ω—å–≥–∏', color: '#22c55e', icon: 'wallet' },
      theater: { label: '–¢–µ–∞—Ç—Ä', color: '#c084fc', icon: 'drama' },
      package: { label: '–ö–æ—Ä–æ–±–∫–∞', color: '#f59e0b', icon: 'box' },
      song: { label: '–ú—É–∑—ã–∫–∞', color: '#60a5fa', icon: 'music' },
      coin: { label: '–ú–æ–Ω–µ—Ç—ã', color: '#fbbf24', icon: 'coins' },
      mind: { label: '–ú–æ–∑–≥', color: '#c084fc', icon: 'brain' },
      secure: { label: '–ó–∞–º–æ–∫', color: '#94a3b8', icon: 'lock' },
      juggle: { label: '–ñ–æ–Ω–≥–ª–µ—Ä', color: '#f59e0b', icon: 'user' }
    };

    // Custom types storage
    let customTypes = {};

    // Get combined types (default + custom - hidden)
    function getTypes() {
      const hiddenTypes = customTypes._hidden || [];
      const result = {};
      
      // Add non-hidden default types
      Object.keys(DEFAULT_TYPES).forEach(key => {
        if(!hiddenTypes.includes(key)) {
          result[key] = DEFAULT_TYPES[key];
        }
      });
      
      // Add custom types (excluding _hidden meta key)
      Object.keys(customTypes).forEach(key => {
        if(key !== '_hidden') {
          result[key] = customTypes[key];
        }
      });
      
      return result;
    }

    // Dynamic TYPES object
    const TYPES = new Proxy({}, {
      get(target, prop) {
        const allTypes = getTypes();
        return allTypes[prop] || DEFAULT_TYPES.rabbit || { label: '–°–æ–±—ã—Ç–∏–µ', color: '#f59e0b', icon: 'sparkles' };
      }
    });

    const MONTH_NAMES = [
      '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
      '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
    ];

    let currentDate = new Date();
    let selectedDate = new Date();
    let events = [];
    let schedule = [{ type: 'rabbit', time: '19:00', duration: 60 }];
    let editingEventId = null;
    let currentView = 'calendar';
    let pickerYear = new Date().getFullYear();
    let currentType = 'rabbit';
    let monthlyGoal = 200000;
    let editingTypeKey = null;
    let selectedColor = '#f59e0b';
    let selectedIcon = 'sparkles';

    // ==========================================
    // STORAGE
    // ==========================================
    function saveEvents() {
      localStorage.setItem('illusionist_events', JSON.stringify(events));
    }

    function loadEvents() {
      const stored = localStorage.getItem('illusionist_events');
      if(stored) {
        events = JSON.parse(stored);
      }
      
      const savedGoal = localStorage.getItem('illusionist_goal');
      if(savedGoal) {
        monthlyGoal = parseFloat(savedGoal) || 200000;
      }

      const savedTypes = localStorage.getItem('illusionist_custom_types');
      if(savedTypes) {
        customTypes = JSON.parse(savedTypes);
      }
    }

    function saveGoalToStorage() {
      localStorage.setItem('illusionist_goal', monthlyGoal.toString());
    }

    function saveCustomTypes() {
      localStorage.setItem('illusionist_custom_types', JSON.stringify(customTypes));
    }

    // ==========================================
    // CUSTOM CONFIRM
    // ==========================================
    function customConfirm(message, onYes) {
      document.getElementById('confirm-message').textContent = message;
      document.getElementById('confirm-modal').classList.add('show');

      const yesBtn = document.getElementById('confirm-yes');
      const noBtn = document.getElementById('confirm-no');

      const cleanup = () => {
        document.getElementById('confirm-modal').classList.remove('show');
        yesBtn.onclick = null;
        noBtn.onclick = null;
      };

      yesBtn.onclick = () => {
        cleanup();
        onYes();
      };

      noBtn.onclick = cleanup;
    }

    // ==========================================
    // TAB SWITCHING
    // ==========================================
    function switchTab(tab) {
      currentView = tab;

      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));

      const bottomNav = document.getElementById('bottom-nav');

      if(tab === 'calendar') {
        document.getElementById('calendar-tab').classList.add('active');
        document.querySelector('[onclick="switchTab(\'calendar\')"]').classList.add('active');
        renderCalendar();

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Å–∫—Ä–æ–ª–ª–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∏ —Å–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –µ—Å–ª–∏ –Ω–µ –≤–Ω–∏–∑—É
        setTimeout(() => {
          const calContainer = document.querySelector('.calendar-container');
          if(calContainer) {
            const scrollTop = calContainer.scrollTop;
            const scrollHeight = calContainer.scrollHeight;
            const clientHeight = calContainer.clientHeight;
            const isAtBottom = scrollTop + clientHeight >= scrollHeight - 10;

            if(!isAtBottom) {
              bottomNav.style.transform = 'translateY(120px)';
              bottomNav.style.opacity = '0';
            } else {
              bottomNav.style.transform = 'translateY(0)';
              bottomNav.style.opacity = '1';
            }
          }
        }, 50);
      } else if(tab === 'dashboard') {
        document.getElementById('dashboard-tab').classList.add('active');
        document.querySelector('[onclick="switchTab(\'dashboard\')"]').classList.add('active');
        renderDashboard();

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Å–∫—Ä–æ–ª–ª–∞ –¥–∞—à–±–æ—Ä–¥–∞ –∏ —Å–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –µ—Å–ª–∏ –Ω–µ –≤–Ω–∏–∑—É
        setTimeout(() => {
          const dashContainer = document.querySelector('.dashboard-container');
          if(dashContainer) {
            const scrollTop = dashContainer.scrollTop;
            const scrollHeight = dashContainer.scrollHeight;
            const clientHeight = dashContainer.clientHeight;
            const isAtBottom = scrollTop + clientHeight >= scrollHeight - 10;

            if(!isAtBottom) {
              bottomNav.style.transform = 'translateY(120px)';
              bottomNav.style.opacity = '0';
            } else {
              bottomNav.style.transform = 'translateY(0)';
              bottomNav.style.opacity = '1';
            }
          }
        }, 50);
      }
    }

    function switchModalTab(tab, event) {
      document.querySelectorAll('.modal-tab').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab-panel').forEach(el => el.classList.remove('active'));

      event.target.classList.add('active');
      document.getElementById(`tab-${tab}`).classList.add('active');

      lucide.createIcons();
    }

    // ==========================================
    // CALENDAR RENDERING
    // ==========================================
    function renderCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      
      document.getElementById('month-title').textContent = `${MONTH_NAMES[month]} ${year}`;
      
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = firstDay.getDay() || 7;
      
      const grid = document.getElementById('calendar-grid');
      grid.innerHTML = '';
      
      // Empty cells before first day
      for(let i = 1; i < startDay; i++) {
        const cell = document.createElement('div');
        cell.className = 'calendar-cell';
        cell.style.opacity = '0.3';
        grid.appendChild(cell);
      }
      
      // Days of month
      const today = new Date();
      const todayStr = formatDate(today);
      
      for(let day = 1; day <= lastDay.getDate(); day++) {
        const date = new Date(year, month, day);
        const dateStr = formatDate(date);
        const dayEvents = events.filter(e => e.date === dateStr);
        
        const cell = document.createElement('div');
        cell.className = 'calendar-cell';
        
        if(dateStr === todayStr) {
          cell.classList.add('today');
        }
        
        if(dateStr === formatDate(selectedDate)) {
          cell.classList.add('selected');
        }
        
        const dateNum = document.createElement('div');
        dateNum.className = 'date-number';
        dateNum.textContent = day;
        cell.appendChild(dateNum);
        
        if(dayEvents.length > 0) {
          const dotsContainer = document.createElement('div');
          dotsContainer.className = 'event-dots';

          dayEvents.slice(0, 3).forEach(event => {
            const dot = document.createElement('div');
            dot.className = 'event-dot';
            if(event.status === 'pending') {
              dot.style.background = '#f59e0b';
            } else if(event.status === 'confirmed') {
              dot.style.background = '#22c55e';
            } else if(event.status === 'cancelled') {
              dot.style.background = '#ef4444';
            }
            dotsContainer.appendChild(dot);
          });

          cell.appendChild(dotsContainer);
        }
        
        cell.onclick = () => selectDate(date);
        grid.appendChild(cell);
      }
      
      renderDayList();
      lucide.createIcons();
    }

    function renderDayList() {
      const container = document.getElementById('day-list');
      const dateStr = formatDate(selectedDate);
      const dayEvents = events.filter(e => e.date === dateStr);

      if(dayEvents.length === 0) {
        container.innerHTML = '';
        return;
      }

      container.innerHTML = `
        <div class="day-list-header">
          –°–æ–±—ã—Ç–∏—è –Ω–∞ ${selectedDate.getDate()} ${MONTH_NAMES[selectedDate.getMonth()].toLowerCase()}
        </div>
      `;

      dayEvents.forEach(event => {
        const typeInfo = TYPES[event.type] || TYPES.rabbit;
        const statusColor = event.status === 'confirmed' ? '#22c55e' : event.status === 'pending' ? '#f59e0b' : '#ef4444';
        const eventDate = new Date(event.date);

        const row = document.createElement('div');
        row.className = 'day-list-row';
        row.style.setProperty('--accent-color', typeInfo.color);

        row.innerHTML = `
          <div style="width: 44px; height: 44px; border-radius: 12px; background: ${typeInfo.color}20; border: 1.5px solid ${typeInfo.color}40; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
            <i data-lucide="${typeInfo.icon}" style="width: 22px; height: 22px; color: ${typeInfo.color};"></i>
          </div>
          <div class="day-list-info" style="flex: 1;">
            <div class="day-list-title">${event.title}</div>
            <div class="day-list-subtitle">
              <i data-lucide="map-pin" style="width: 14px; height: 14px;"></i>
              <span>${event.location || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</span>
            </div>
          </div>
          ${event.address ? `
          <button class="nav-btn" onclick="openNavigation('${event.address}', event)" style="width: 40px; height: 40px; padding: 0; margin-right: 8px; flex-shrink: 0;" title="–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç">
            <i data-lucide="navigation" style="width: 20px; height: 20px;"></i>
          </button>
          ` : ''}
          <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 6px;">
            <div class="day-list-time">${event.time || '‚Äî'}</div>
            <div style="width: 8px; height: 8px; border-radius: 50%; background: ${statusColor}; box-shadow: 0 0 8px ${statusColor};"></div>
          </div>
        `;

        row.querySelector('.day-list-info')?.addEventListener('click', () => editEvent(event.id));
        container.appendChild(row);
      });
      
      lucide.createIcons();
    }

    // ==========================================
    // DASHBOARD
    // ==========================================
    function renderDashboard() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      
      const monthEvents = events.filter(e => {
        const eventDate = new Date(e.date);
        return eventDate.getFullYear() === year && eventDate.getMonth() === month;
      });
      
      const totalShows = monthEvents.reduce((sum, e) => sum + (e.schedule?.length || 1), 0);
      const totalIncome = monthEvents.reduce((sum, e) => sum + (e.income || 0), 0);
      const totalExpense = monthEvents.reduce((sum, e) => sum + (e.expense || 0), 0);
      const totalPrepay = monthEvents.reduce((sum, e) => sum + (e.prepay || 0), 0);
      const totalTax = monthEvents.reduce((sum, e) => {
        const taxAmount = ((e.income || 0) * (e.tax || 0)) / 100;
        return sum + taxAmount;
      }, 0);
      const profit = totalIncome - totalExpense;
      const avgCheck = monthEvents.length > 0 ? Math.round(totalIncome / monthEvents.length) : 0;
      const netProfit = totalIncome - totalExpense - totalTax;

      // Update KPIs
      document.getElementById('profit-amount').textContent = `${Math.round(profit).toLocaleString('ru-RU')} ‚ÇΩ`;
      document.getElementById('kpi-income').textContent = `${Math.round(totalIncome).toLocaleString('ru-RU')} ‚ÇΩ`;
      document.getElementById('kpi-expense').textContent = `${Math.round(totalExpense).toLocaleString('ru-RU')} ‚ÇΩ`;
      document.getElementById('kpi-shows').textContent = `${totalShows} (${monthEvents.length} –≤—ã—Ö.)`;
      document.getElementById('kpi-avg').textContent = `${avgCheck.toLocaleString('ru-RU')} ‚ÇΩ`;
      document.getElementById('kpi-balance').textContent = `${Math.round(netProfit).toLocaleString('ru-RU')} ‚ÇΩ`;
      document.getElementById('kpi-tax').textContent = `${Math.round(totalTax).toLocaleString('ru-RU')} ‚ÇΩ`;
      
      // Goal progress
      const goalPercent = monthlyGoal > 0 ? Math.min(Math.round((netProfit / monthlyGoal) * 100), 100) : 0;
      document.getElementById('goal-progress').style.width = `${goalPercent}%`;
      document.getElementById('goal-percent').textContent = `${goalPercent}%`;
      document.getElementById('goal-text').textContent = `–¶–µ–ª—å: ${monthlyGoal.toLocaleString('ru-RU')} ‚ÇΩ`;

      // Check if goal achieved (100% or more) and trigger celebration
      if(monthlyGoal > 0 && netProfit >= monthlyGoal) {
        const celebrationKey = `goal-celebration-${year}-${month}`;
        const hasSeenCelebration = localStorage.getItem(celebrationKey);

        if(!hasSeenCelebration) {
          setTimeout(() => {
            triggerMagicHatCelebration();
            localStorage.setItem(celebrationKey, 'true');
          }, 800);
        }
      }
      
      // Insights
      const insights = [];
      if(monthEvents.length > 0) {
        insights.push(`üìä –í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ ${monthEvents.length} —Å–æ–±—ã—Ç–∏–π (${totalShows} –≤—ã—Ö–æ–¥–æ–≤)`);
        
        if(profit > 0) {
          insights.push(`üí∞ –ü—Ä–∏–±—ã–ª—å —Å–æ—Å—Ç–∞–≤–∏–ª–∞ ${Math.round(profit).toLocaleString('ru-RU')} ‚ÇΩ`);
        }
        
        if(avgCheck > 0) {
          insights.push(`üìà –°—Ä–µ–¥–Ω–∏–π —á–µ–∫: ${avgCheck.toLocaleString('ru-RU')} ‚ÇΩ`);
        }

        const remainingBalance = totalIncome - totalPrepay;
        if(remainingBalance > 0) {
          insights.push(`üí≥ –û—Å—Ç–∞–ª–æ—Å—å —Å–æ–±—Ä–∞—Ç—å ${Math.round(remainingBalance).toLocaleString('ru-RU')} ‚ÇΩ`);
        }
        
        const profitMargin = totalIncome > 0 ? Math.round((profit / totalIncome) * 100) : 0;
        if(profitMargin > 0) {
          insights.push(`üìä –ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å: ${profitMargin}%`);
        }
      } else {
        insights.push('üìÖ –í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π');
      }
      
      const insightsList = document.getElementById('insights-list');
      insightsList.innerHTML = insights.map(i => `<div>${i}</div>`).join('');
      
      // Type analytics
      const typeStats = {};
      monthEvents.forEach(event => {
        if(event.schedule && event.schedule.length > 0) {
          // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º show –ø–æ —Ç–∏–ø–∞–º –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
          const eventTypeGroups = {};
          event.schedule.forEach(show => {
            const type = show.type || 'rabbit';
            if(!eventTypeGroups[type]) {
              eventTypeGroups[type] = 0;
            }
            eventTypeGroups[type]++;
          });

          // –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
          Object.keys(eventTypeGroups).forEach(type => {
            if(!typeStats[type]) {
              typeStats[type] = { count: 0, income: 0 };
            }
            typeStats[type].count += eventTypeGroups[type];
            typeStats[type].income += (event.income || 0) * (eventTypeGroups[type] / event.schedule.length);
          });
        } else {
          // –°–æ–±—ã—Ç–∏–µ –±–µ–∑ schedule - –∏—Å–ø–æ–ª—å–∑—É–µ–º event.type
          const type = event.type || 'rabbit';
          if(!typeStats[type]) {
            typeStats[type] = { count: 0, income: 0 };
          }
          typeStats[type].count++;
          typeStats[type].income += event.income || 0;
        }
      });
      
      const typesList = document.getElementById('types-list');
      typesList.innerHTML = '';
      
      Object.keys(typeStats).sort((a, b) => typeStats[b].count - typeStats[a].count).forEach(type => {
        const allTypes = getTypes();
        const typeInfo = allTypes[type] || allTypes[Object.keys(allTypes)[0]];
        const stats = typeStats[type];
        const percent = totalShows > 0 ? Math.round((stats.count / totalShows) * 100) : 0;
        
        const div = document.createElement('div');
        div.style.cssText = 'background: linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); border: 1px solid rgba(245,158,11,0.1); border-radius: 14px; padding: 14px;';
        div.innerHTML = `
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
            <div style="display: flex; align-items: center; gap: 10px;">
              <i data-lucide="${typeInfo.icon}" style="width: 20px; height: 20px; color: ${typeInfo.color};"></i>
              <span style="font-size: 14px; font-weight: 700; color: #fff;">${typeInfo.label}</span>
            </div>
            <span style="font-size: 13px; font-weight: 800; color: ${typeInfo.color}; font-family: 'JetBrains Mono', monospace;">${stats.count}</span>
          </div>
          <div style="height: 6px; background: rgba(0,0,0,0.3); border-radius: 999px; overflow: hidden; margin-bottom: 8px;">
            <div style="height: 100%; background: ${typeInfo.color}; width: ${percent}%; transition: width 0.5s;"></div>
          </div>
          <div style="display: flex; justify-content: space-between; font-size: 11px; color: rgba(148,163,184,0.8);">
            <span>${percent}% –æ—Ç –≤—Å–µ—Ö</span>
            <span>${Math.round(stats.income).toLocaleString('ru-RU')} ‚ÇΩ</span>
          </div>
        `;
        typesList.appendChild(div);
      });
      
      // Top type
      const sortedTypes = Object.keys(typeStats).sort((a, b) => typeStats[b].count - typeStats[a].count);
      if(sortedTypes.length > 0) {
        const topType = sortedTypes[0];
        const allTypes = getTypes();
        document.getElementById('kpi-top-type').textContent = allTypes[topType]?.label || topType;
      } else {
        document.getElementById('kpi-top-type').textContent = '‚Äî';
      }
      
      // Best day (highest income day)
      const dayIncomes = {};
      monthEvents.forEach(event => {
        const day = new Date(event.date).getDate();
        if(!dayIncomes[day]) dayIncomes[day] = 0;
        dayIncomes[day] += event.income || 0;
      });
      
      const bestDay = Object.keys(dayIncomes).sort((a, b) => dayIncomes[b] - dayIncomes[a])[0];
      if(bestDay) {
        document.getElementById('kpi-best-day').textContent = `${bestDay} ${MONTH_NAMES[month]}`;
      } else {
        document.getElementById('kpi-best-day').textContent = '‚Äî';
      }
      
      // Upcoming events list
      const listContainer = document.getElementById('dashboard-list');
      const upcomingEvents = events
        .filter(e => new Date(e.date) >= new Date())
        .sort((a, b) => new Date(a.date) - new Date(b.date))
        .slice(0, 10);
      
      if(upcomingEvents.length === 0) {
        listContainer.innerHTML = '<div style="text-align: center; padding: 24px; color: rgba(148,163,184,0.6);">–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π</div>';
      } else {
        listContainer.innerHTML = '';
        
        upcomingEvents.forEach(event => {
          const allTypes = getTypes();
          const typeInfo = allTypes[event.type] || allTypes[Object.keys(allTypes)[0]];
          const eventDate = new Date(event.date);
          const statusColor = event.status === 'confirmed' ? '#22c55e' : event.status === 'pending' ? '#f59e0b' : '#ef4444';

          const row = document.createElement('div');
          row.className = 'day-list-row';
          row.style.setProperty('--accent-color', typeInfo.color);

          row.innerHTML = `
            <div style="width: 44px; height: 44px; border-radius: 12px; background: ${typeInfo.color}20; border: 1.5px solid ${typeInfo.color}40; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
              <i data-lucide="${typeInfo.icon}" style="width: 22px; height: 22px; color: ${typeInfo.color};"></i>
            </div>
            <div class="day-list-info">
              <div class="day-list-title">${event.title}</div>
              <div class="day-list-subtitle">
                <i data-lucide="calendar" style="width: 14px; height: 14px;"></i>
                <span>${eventDate.getDate()} ${MONTH_NAMES[eventDate.getMonth()]}</span>
              </div>
            </div>
            <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 6px;">
              <div class="day-list-time">${event.time || '‚Äî'}</div>
              <div style="width: 8px; height: 8px; border-radius: 50%; background: ${statusColor}; box-shadow: 0 0 8px ${statusColor};"></div>
            </div>
          `;

          row.onclick = () => {
            switchTab('calendar');
            currentDate = new Date(event.date);
            selectedDate = new Date(event.date);
            renderCalendar();
            setTimeout(() => editEvent(event.id), 100);
          };
          
          listContainer.appendChild(row);
        });
      }
      
      lucide.createIcons();
    }

    // ==========================================
    // NAVIGATION
    // ==========================================
    function changeMonth(delta) {
      currentDate.setMonth(currentDate.getMonth() + delta);
      renderCalendar();
    }

    function selectDate(date) {
      selectedDate = new Date(date);
      renderCalendar();
    }

    // ==========================================
    // SETTINGS
    // ==========================================
    function openSettingsModal() {
      document.getElementById('goal-input').value = monthlyGoal;
      renderCustomTypesList();
      document.getElementById('settings-modal').classList.add('show');
      lucide.createIcons();
    }

    function closeSettingsModal() {
      document.getElementById('settings-modal').classList.remove('show');
    }

    function saveGoal() {
      const value = parseFloat(document.getElementById('goal-input').value);
      if(value > 0) {
        monthlyGoal = value;
        saveGoalToStorage();
        renderDashboard();
        showToast('–¶–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
      } else {
        showToast('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ');
      }
    }

    function exportData() {
      const data = {
        events: events,
        goal: monthlyGoal,
        version: 'v3.0',
        date: new Date().toISOString()
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `IllusionistOS_Backup_${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showToast('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
    }

    function importData(input) {
      const file = input.files[0];
      if(!file) return;
      
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target.result);
          
          if(data.events) {
            events = data.events;
            saveEvents();
          }
          
          if(data.goal) {
            monthlyGoal = parseFloat(data.goal) || 200000;
            saveGoalToStorage();
          }
          
          renderCalendar();
          if(currentView === 'dashboard') {
            renderDashboard();
          }
          
          closeSettingsModal();
          showToast('–î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
        } catch(err) {
          showToast('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö');
        }
      };
      reader.readAsText(file);
    }

    function resetData() {
      customConfirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –∏ —Å–±—Ä–æ—Å–∏—Ç—å —Ü–µ–ª—å? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!', () => {
        events = [];
        monthlyGoal = 200000;
        localStorage.removeItem('illusionist_events');
        localStorage.removeItem('illusionist_goal');

        renderCalendar();
        renderDayList();
        if(currentView === 'dashboard') {
          renderDashboard();
        }
        closeSettingsModal();
        showToast('–î–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã');
      });
    }

    function resetCelebrations() {
      // Remove all celebration flags
      const keys = Object.keys(localStorage);
      keys.forEach(key => {
        if(key.startsWith('goal-celebration-')) {
          localStorage.removeItem(key);
        }
      });
      
      closeSettingsModal();
      showToast('–ê–Ω–∏–º–∞—Ü–∏–∏ —Å–±—Ä–æ—à–µ–Ω—ã! –û—Ç–∫—Ä–æ–π—Ç–µ Dashboard');
    }

    // ==========================================
    // CUSTOM TYPES
    // ==========================================
    function openTypeEditor(typeKey = null) {
      editingTypeKey = typeKey;
      
      if(typeKey) {
        const type = getTypes()[typeKey];
        if(type) {
          document.getElementById('type-editor-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø';
          document.getElementById('type-name').value = type.label;
          selectedColor = type.color;
          selectedIcon = type.icon;
          document.getElementById('delete-type-btn').style.display = 'block';
        }
      } else {
        document.getElementById('type-editor-title').textContent = '–ù–æ–≤—ã–π —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è';
        document.getElementById('type-name').value = '';
        selectedColor = '#f59e0b';
        selectedIcon = 'sparkles';
        document.getElementById('delete-type-btn').style.display = 'none';
      }
      
      renderIconGrid();
      updateColorSelection();
      document.getElementById('type-editor-modal').classList.add('show');
      lucide.createIcons();
    }

    function closeTypeEditor() {
      document.getElementById('type-editor-modal').classList.remove('show');
      editingTypeKey = null;
    }

    function renderIconGrid() {
      const grid = document.getElementById('icon-grid');
      grid.innerHTML = '';
      
      AVAILABLE_ICONS.forEach(icon => {
        const btn = document.createElement('button');
        btn.className = 'icon-btn';
        if(icon === selectedIcon) btn.classList.add('selected');
        btn.innerHTML = `<i data-lucide="${icon}"></i>`;
        btn.onclick = () => {
          selectedIcon = icon;
          document.querySelectorAll('.icon-btn').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
        };
        grid.appendChild(btn);
      });
      
      lucide.createIcons();
    }

    function selectColor(color) {
      selectedColor = color;
      updateColorSelection();
    }

    function updateColorSelection() {
      document.querySelectorAll('.color-btn').forEach(btn => {
        if(btn.dataset.color === selectedColor) {
          btn.classList.add('selected');
        } else {
          btn.classList.remove('selected');
        }
      });
    }

    function saveCustomType() {
      const name = document.getElementById('type-name').value.trim();
      
      if(!name) {
        showToast('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–ø–∞');
        return;
      }
      
      const key = editingTypeKey || `custom_${Date.now()}`;
      
      customTypes[key] = {
        label: name,
        color: selectedColor,
        icon: selectedIcon
      };
      
      saveCustomTypes();
      closeTypeEditor();
      renderCustomTypesList();
      showToast(editingTypeKey ? '–¢–∏–ø –æ–±–Ω–æ–≤–ª—ë–Ω!' : '–¢–∏–ø —Å–æ–∑–¥–∞–Ω!');
      lucide.createIcons();
    }

    function deleteCustomType() {
      if(!editingTypeKey) return;

      const type = getTypes()[editingTypeKey];
      const key = editingTypeKey;

      customConfirm(`–£–¥–∞–ª–∏—Ç—å —Ç–∏–ø "${type.label}"?`, () => {
        // Check if any events use this type
        const eventsUsingType = events.filter(e => {
          if(e.type === key) return true;
          if(e.schedule) {
            return e.schedule.some(s => s.type === key);
          }
          return false;
        });

        const performDelete = () => {
          if(eventsUsingType.length > 0) {
            // Update events to use default type
            events.forEach(event => {
              if(event.type === key) {
                event.type = 'rabbit';
              }
              if(event.schedule) {
                event.schedule.forEach(s => {
                  if(s.type === key) {
                    s.type = 'rabbit';
                  }
                });
              }
            });
            saveEvents();
          }

          // Remove from custom types or hide default
          if(DEFAULT_TYPES[key]) {
            if(!customTypes._hidden) customTypes._hidden = [];
            if(!customTypes._hidden.includes(key)) {
              customTypes._hidden.push(key);
            }
          } else {
            delete customTypes[key];
          }

          saveCustomTypes();
          closeTypeEditor();
          renderCustomTypesList();
          renderCalendar();
          renderDayList();
          if(currentView === 'dashboard') {
            renderDashboard();
          }
          showToast('–¢–∏–ø —É–¥–∞–ª—ë–Ω');
          lucide.createIcons();
        };

        if(eventsUsingType.length > 0) {
          customConfirm(`${eventsUsingType.length} —Å–æ–±—ã—Ç–∏–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–æ—Ç —Ç–∏–ø. –û–Ω–∏ –±—É–¥—É—Ç –∏–∑–º–µ–Ω–µ–Ω—ã –Ω–∞ "–ö—Ä–æ–ª–∏–∫". –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?`, performDelete);
        } else {
          performDelete();
        }
      });
    }

    function renderCustomTypesList() {
      const container = document.getElementById('custom-types-list');
      const allTypes = getTypes();
      
      container.innerHTML = '';
      
      Object.keys(allTypes).forEach(key => {
        const type = allTypes[key];
        const isDefault = DEFAULT_TYPES[key];
        
        const row = document.createElement('div');
        row.style.cssText = 'display: flex; align-items: center; gap: 12px; padding: 12px; background: linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); border: 1px solid rgba(245,158,11,0.1); border-radius: 12px; transition: all 0.3s;';
        
        row.innerHTML = `
          <div style="width: 40px; height: 40px; background: rgba(245,158,11,0.08); border: 1px solid rgba(245,158,11,0.15); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
            <i data-lucide="${type.icon}" style="width: 20px; height: 20px; color: ${type.color};"></i>
          </div>
          <div style="flex: 1; min-width: 0; cursor: pointer;" onclick="openTypeEditor('${key}')">
            <div style="font-size: 14px; font-weight: 700; color: #fff;">${type.label}</div>
            <div style="font-size: 11px; color: rgba(148,163,184,0.7); margin-top: 2px;">${isDefault ? '–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π'}</div>
          </div>
          <div style="width: 24px; height: 24px; border-radius: 6px; background: ${type.color}; border: 2px solid rgba(255,255,255,0.2); flex-shrink: 0;"></div>
          <button onclick="event.stopPropagation(); deleteTypeFromList('${key}')" style="width: 36px; height: 36px; background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: #ef4444; transition: all 0.3s; flex-shrink: 0;" onmouseenter="this.style.background='rgba(239,68,68,0.2)'; this.style.transform='scale(1.05)';" onmouseleave="this.style.background='rgba(239,68,68,0.1)'; this.style.transform='scale(1)';">
            <i data-lucide="trash-2" style="width: 16px; height: 16px;"></i>
          </button>
        `;
        
        container.appendChild(row);
      });
      
      lucide.createIcons();
    }

    function deleteTypeFromList(key) {
      const type = getTypes()[key];

      customConfirm(`–£–¥–∞–ª–∏—Ç—å —Ç–∏–ø "${type.label}"?`, () => {
        // Check if any events use this type
        const eventsUsingType = events.filter(e => {
          if(e.type === key) return true;
          if(e.schedule) {
            return e.schedule.some(s => s.type === key);
          }
          return false;
        });

        const performDelete = () => {
          if(eventsUsingType.length > 0) {
            // Update events to use default type
            events.forEach(event => {
              if(event.type === key) {
                event.type = 'rabbit';
              }
              if(event.schedule) {
                event.schedule.forEach(s => {
                  if(s.type === key) {
                    s.type = 'rabbit';
                  }
                });
              }
            });
            saveEvents();
          }

          // Remove from custom types or hide default
          if(DEFAULT_TYPES[key]) {
            // For default types, we'll hide them by overriding in customTypes
            if(!customTypes._hidden) customTypes._hidden = [];
            if(!customTypes._hidden.includes(key)) {
              customTypes._hidden.push(key);
            }
          } else {
            delete customTypes[key];
          }

          saveCustomTypes();
          renderCustomTypesList();
          renderCalendar();
          renderDayList();
          if(currentView === 'dashboard') {
            renderDashboard();
          }
          showToast('–¢–∏–ø —É–¥–∞–ª—ë–Ω');
          lucide.createIcons();
        };

        if(eventsUsingType.length > 0) {
          customConfirm(`${eventsUsingType.length} —Å–æ–±—ã—Ç–∏–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–æ—Ç —Ç–∏–ø. –û–Ω–∏ –±—É–¥—É—Ç –∏–∑–º–µ–Ω–µ–Ω—ã –Ω–∞ "–ö—Ä–æ–ª–∏–∫". –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?`, performDelete);
        } else {
          performDelete();
        }
      });
    }

    // ==========================================
    // MONTH PICKER
    // ==========================================
    function openMonthPicker() {
      pickerYear = currentDate.getFullYear();
      document.getElementById('picker-year').textContent = pickerYear;
      highlightCurrentMonth();
      document.getElementById('month-picker-modal').classList.add('show');
      lucide.createIcons();
    }

    function closeMonthPicker() {
      document.getElementById('month-picker-modal').classList.remove('show');
    }

    function changePickerYear(delta) {
      pickerYear += delta;
      document.getElementById('picker-year').textContent = pickerYear;
      highlightCurrentMonth();
    }

    function selectMonth(monthIndex) {
      currentDate = new Date(pickerYear, monthIndex, 1);
      selectedDate = new Date(pickerYear, monthIndex, 1);
      renderCalendar();
      if(currentView === 'dashboard') {
        renderDashboard();
      }
      closeMonthPicker();
    }

    function highlightCurrentMonth() {
      const buttons = document.querySelectorAll('.month-btn');
      const currentMonth = currentDate.getMonth();
      const currentYear = currentDate.getFullYear();
      
      buttons.forEach((btn, index) => {
        if(pickerYear === currentYear && index === currentMonth) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
    }

    // ==========================================
    // EVENT MODAL
    // ==========================================
    function openEventModal(date = null) {
      editingEventId = null;
      document.getElementById('modal-title').textContent = '–ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ';
      document.getElementById('delete-btn').style.display = 'none';
      
      resetForm();
      
      const dateInput = document.getElementById('event-date');
      if(date) {
        dateInput.value = formatDateInput(date);
      } else {
        dateInput.value = formatDateInput(selectedDate);
      }
      
      document.getElementById('event-modal').classList.add('show');
      lucide.createIcons();
    }

    function editEvent(eventId) {
      const event = events.find(e => e.id === eventId);
      if(!event) return;
      
      editingEventId = eventId;
      document.getElementById('modal-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
      document.getElementById('delete-btn').style.display = 'block';
      
      document.getElementById('event-title').value = event.title || '';
      document.getElementById('event-date').value = event.date || '';
      document.getElementById('event-status').value = event.status || 'pending';
      document.getElementById('event-location').value = event.location || '';
      document.getElementById('event-address').value = event.address || '';
      document.getElementById('event-client').value = event.client || '';
      document.getElementById('event-phone').value = event.phone || '';
      document.getElementById('event-guests').value = event.guests || '';
      document.getElementById('event-income').value = event.income || '';
      document.getElementById('event-prepay').value = event.prepay || '';
      document.getElementById('event-expense').value = event.expense || '';
      document.getElementById('event-tax').value = event.tax || '';
      document.getElementById('event-notes').value = event.notes || '';
      
      schedule = event.schedule || [{ type: 'rabbit', time: '19:00', duration: 60 }];
      renderSchedule();
      calculateBalance();
      
      const firstTab = document.querySelector('.modal-tab');
      if(firstTab) firstTab.click();
      
      document.getElementById('event-modal').classList.add('show');
      lucide.createIcons();
    }

    function closeEventModal() {
      document.getElementById('event-modal').classList.remove('show');
      resetForm();
    }

    function resetForm() {
      document.getElementById('event-title').value = '';
      document.getElementById('event-location').value = '';
      document.getElementById('event-address').value = '';
      document.getElementById('event-client').value = '';
      document.getElementById('event-phone').value = '';
      document.getElementById('event-guests').value = '';
      document.getElementById('event-income').value = '';
      document.getElementById('event-prepay').value = '';
      document.getElementById('event-expense').value = '';
      document.getElementById('event-tax').value = '';
      document.getElementById('event-notes').value = '';
      document.getElementById('balance-display').textContent = '0 ‚ÇΩ';

      schedule = [{ type: 'rabbit', time: '19:00', duration: 60 }];
      renderSchedule();
      
      const firstTab = document.querySelector('.modal-tab');
      if(firstTab) firstTab.click();
    }

    // ==========================================
    // SCHEDULE MANAGEMENT
    // ==========================================
    function addScheduleItem() {
      schedule.push({
        type: currentType || 'rabbit',
        time: '19:00',
        duration: 60
      });
      renderSchedule();
      lucide.createIcons();
    }

    function removeScheduleItem(index) {
      if(schedule.length === 1) {
        showToast('–î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤—ã—Ö–æ–¥');
        return;
      }
      schedule.splice(index, 1);
      renderSchedule();
      lucide.createIcons();
    }

    function cycleScheduleType(index) {
      const types = Object.keys(getTypes());
      const currentIndex = types.indexOf(schedule[index].type);
      const nextIndex = (currentIndex + 1) % types.length;
      schedule[index].type = types[nextIndex];
      renderSchedule();
      lucide.createIcons();
    }

    function updateScheduleTime(index, time) {
      schedule[index].time = time;
    }

    function updateScheduleDuration(index, duration) {
      schedule[index].duration = parseInt(duration) || 60;
    }

    function renderSchedule() {
      const container = document.getElementById('schedule-list');
      container.innerHTML = '';

      schedule.forEach((item, index) => {
        const allTypes = getTypes();
        const typeInfo = allTypes[item.type] || allTypes[Object.keys(allTypes)[0]];

        const div = document.createElement('div');
        div.className = 'schedule-item';

        div.innerHTML = `
          <button type="button" class="schedule-type-btn" onclick="cycleScheduleType(${index})" style="color: ${typeInfo.color};" title="${typeInfo.label}">
            <i data-lucide="${typeInfo.icon}"></i>
          </button>

          <div class="schedule-inputs">
            <input type="time" value="${item.time}" onchange="updateScheduleTime(${index}, this.value)" style="flex: 1;">
          </div>

          <input type="number" class="schedule-duration" value="${item.duration}" onchange="updateScheduleDuration(${index}, this.value)" placeholder="–º–∏–Ω" min="1">

          <button type="button" class="schedule-remove" onclick="removeScheduleItem(${index})">
            <i data-lucide="x"></i>
          </button>
        `;

        container.appendChild(div);

        if(!item.checklist) item.checklist = [];

        const checklistDiv = document.createElement('div');
        checklistDiv.style.cssText = 'margin-top: 8px; padding-left: 48px;';

        item.checklist.forEach((check, checkIndex) => {
          const checkItem = document.createElement('div');
          checkItem.style.cssText = 'display: flex; align-items: center; gap: 8px; margin-bottom: 6px;';
          checkItem.innerHTML = `
            <input type="checkbox" ${check.done ? 'checked' : ''} onchange="toggleChecklistItem(${index}, ${checkIndex})" style="width: 16px; height: 16px; cursor: pointer;">
            <input type="text" value="${check.text}" onchange="updateChecklistItem(${index}, ${checkIndex}, this.value)" placeholder="–ü—É–Ω–∫—Ç –ø—Ä–æ–≥—Ä–∞–º–º—ã" style="flex: 1; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 6px 10px; color: #e2e8f0; font-size: 13px;">
            <button type="button" onclick="removeChecklistItem(${index}, ${checkIndex})" style="width: 28px; height: 28px; border-radius: 6px; background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.2); color: #ef4444; display: flex; align-items: center; justify-content: center; cursor: pointer;">
              <i data-lucide="x" style="width: 14px; height: 14px;"></i>
            </button>
          `;
          checklistDiv.appendChild(checkItem);
        });

        const addBtn = document.createElement('button');
        addBtn.type = 'button';
        addBtn.onclick = () => addChecklistItem(index);
        addBtn.style.cssText = 'margin-top: 6px; padding: 6px 12px; background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.2); color: #f59e0b; border-radius: 8px; font-size: 12px; cursor: pointer; display: flex; align-items: center; gap: 6px;';
        addBtn.innerHTML = '<i data-lucide="plus" style="width: 14px; height: 14px;"></i> –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç';
        checklistDiv.appendChild(addBtn);

        container.appendChild(checklistDiv);
      });

      lucide.createIcons();
    }

    function addChecklistItem(scheduleIndex) {
      if(!schedule[scheduleIndex].checklist) schedule[scheduleIndex].checklist = [];
      schedule[scheduleIndex].checklist.push({ text: '', done: false });
      renderSchedule();
    }

    function removeChecklistItem(scheduleIndex, checkIndex) {
      schedule[scheduleIndex].checklist.splice(checkIndex, 1);
      renderSchedule();
    }

    function updateChecklistItem(scheduleIndex, checkIndex, text) {
      schedule[scheduleIndex].checklist[checkIndex].text = text;
    }

    function toggleChecklistItem(scheduleIndex, checkIndex) {
      schedule[scheduleIndex].checklist[checkIndex].done = !schedule[scheduleIndex].checklist[checkIndex].done;
    }

    // ==========================================
    // EVENT SAVE/DELETE
    // ==========================================
    function calculateBalance() {
      const income = parseFloat(document.getElementById('event-income').value) || 0;
      const prepay = parseFloat(document.getElementById('event-prepay').value) || 0;
      const expense = parseFloat(document.getElementById('event-expense').value) || 0;
      const taxPercent = parseFloat(document.getElementById('event-tax').value) || 0;

      const remainder = income - prepay - expense;
      const taxAmount = (remainder * taxPercent) / 100;
      const balance = remainder - taxAmount;

      document.getElementById('balance-display').textContent = `${balance.toLocaleString('ru-RU')} ‚ÇΩ`;
    }

    function saveEvent() {
      const title = document.getElementById('event-title').value.trim();
      const date = document.getElementById('event-date').value;
      
      if(!title) {
        showToast('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è');
        return;
      }
      
      if(!date) {
        showToast('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É');
        return;
      }

      const sortedSchedule = schedule.length > 0 ? [...schedule].sort((a, b) => {
        return (a.time || '').localeCompare(b.time || '');
      }) : [];
      const mainTime = sortedSchedule.length > 0 ? sortedSchedule[0].time : '';
      const mainType = sortedSchedule.length > 0 ? sortedSchedule[0].type : 'rabbit';

      const eventData = {
        type: mainType,
        title: title,
        date: date,
        time: mainTime,
        status: document.getElementById('event-status').value || 'pending',
        schedule: schedule.map(item => ({
          type: item.type,
          time: item.time,
          duration: parseInt(item.duration) || 60
        })),
        location: document.getElementById('event-location').value,
        address: document.getElementById('event-address').value,
        client: document.getElementById('event-client').value,
        phone: document.getElementById('event-phone').value,
        guests: parseInt(document.getElementById('event-guests').value) || 0,
        income: parseFloat(document.getElementById('event-income').value) || 0,
        prepay: parseFloat(document.getElementById('event-prepay').value) || 0,
        expense: parseFloat(document.getElementById('event-expense').value) || 0,
        tax: parseFloat(document.getElementById('event-tax').value) || 0,
        notes: document.getElementById('event-notes').value
      };
      
      if(editingEventId) {
        const index = events.findIndex(e => e.id === editingEventId);
        if(index !== -1) {
          events[index] = { ...events[index], ...eventData };
          showToast('–°–æ–±—ã—Ç–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!');
        }
      } else {
        events.push({ id: Date.now(), ...eventData });
        showToast('–°–æ–±—ã—Ç–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
      }
      
      saveEvents();
      closeEventModal();
      renderCalendar();
      
      if(currentView === 'dashboard') {
        renderDashboard();
      }
    }

    function deleteEvent() {
      if(!editingEventId) return;

      customConfirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ?', () => {
        events = events.filter(e => e.id !== editingEventId);
        saveEvents();
        closeEventModal();
        renderCalendar();
        renderDayList();

        if(currentView === 'dashboard') {
          renderDashboard();
        }

        showToast('–°–æ–±—ã—Ç–∏–µ —É–¥–∞–ª–µ–Ω–æ');
      });
    }

    // ==========================================
    // SPLASH SCREEN
    // ==========================================
    function showSplashScreen() {
      const splash = document.getElementById('splash-screen');
      
      // Hide splash after 2 seconds
      setTimeout(() => {
        splash.classList.add('hide');
        
        // Remove from DOM after fade out
        setTimeout(() => {
          splash.remove();
        }, 600);
      }, 2000);
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      const msg = document.getElementById('toast-msg');

      msg.textContent = message;
      toast.classList.add('show');

      clearTimeout(window.toastTimer);
      window.toastTimer = setTimeout(() => {
        toast.classList.remove('show');
      }, 2500);
    }

    // ==========================================
    // NAVIGATION
    // ==========================================
    function openNavigation(address, event) {
      if(event) {
        event.stopPropagation();
        event.preventDefault();
      }

      if(!address || address.trim() === '') {
        showToast('–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω');
        return;
      }

      // –ö–æ–¥–∏—Ä—É–µ–º –∞–¥—Ä–µ—Å –¥–ª—è URL
      const encodedAddress = encodeURIComponent(address);

      // –ü—Ä–æ–±—É–µ–º –æ—Ç–∫—Ä—ã—Ç—å –Ø–Ω–¥–µ–∫—Å.–ù–∞–≤–∏–≥–∞—Ç–æ—Ä
      const yandexNaviUrl = `yandexnavi://build_route_on_map?addr_to=${encodedAddress}`;

      // –†–µ–∑–µ—Ä–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç - –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã
      const yandexMapsUrl = `https://yandex.ru/maps/?text=${encodedAddress}&mode=routes`;

      // –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä
      window.location.href = yandexNaviUrl;

      // –ï—Å–ª–∏ –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –æ—Ç–∫—Ä–æ–µ–º –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã
      setTimeout(() => {
        if(document.hidden) return; // –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—à–ª–æ –≤ —Ñ–æ–Ω, –∑–Ω–∞—á–∏—Ç –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä –æ—Ç–∫—Ä—ã–ª—Å—è
        window.open(yandexMapsUrl, '_blank');
      }, 1000);
    }

    // ==========================================
    // MAGIC HAT CELEBRATION
    // ==========================================
    function triggerMagicHatCelebration() {
      const container = document.getElementById('celebration-container');
      const hat = document.getElementById('magic-hat');
      const message = document.getElementById('goal-message');
      
      // Show container
      container.classList.add('show');
      
      // Show hat with animation
      setTimeout(() => {
        hat.classList.add('show');
      }, 100);
      
      // Start fountain effect after hat appears
      setTimeout(() => {
        startSparkFountain();
      }, 1000);
      
      // Show message
      setTimeout(() => {
        message.classList.add('show');
      }, 2000);
      
      // Hide everything
      setTimeout(() => {
        message.classList.remove('show');
      }, 5000);
      
      setTimeout(() => {
        hat.classList.remove('show');
      }, 5500);
      
      setTimeout(() => {
        container.classList.remove('show');
      }, 6000);
    }

    function startSparkFountain() {
      const hat = document.getElementById('magic-hat');
      const particleCount = 120;
      const duration = 3000; // 3 seconds of fountain
      
      let particlesCreated = 0;
      
      const interval = setInterval(() => {
        if(particlesCreated >= particleCount) {
          clearInterval(interval);
          return;
        }
        
        // Create sparkles
        for(let i = 0; i < 3; i++) {
          createSparkle(hat);
        }
        
        // Create stars occasionally
        if(Math.random() > 0.7) {
          createStar(hat);
        }
        
        particlesCreated++;
      }, 25);
    }

    function createSparkle(hat) {
      const sparkle = document.createElement('div');
      sparkle.className = 'sparkle';
      
      // Random direction upward (fountain effect)
      const angle = (Math.random() * 60 - 30) * Math.PI / 180; // -30 to +30 degrees from vertical
      const velocity = 150 + Math.random() * 200;
      const duration = 0.8 + Math.random() * 0.6;
      
      const tx = Math.sin(angle) * velocity;
      const ty = -Math.cos(angle) * velocity;
      
      sparkle.style.left = '100px';
      sparkle.style.bottom = '170px';
      sparkle.style.setProperty('--tx', `${tx}px`);
      sparkle.style.setProperty('--ty', `${ty}px`);
      sparkle.style.animationDuration = `${duration}s`;
      
      hat.appendChild(sparkle);
      
      setTimeout(() => {
        sparkle.remove();
      }, duration * 1000);
    }

    function createStar(hat) {
      const star = document.createElement('div');
      star.className = 'star-particle';
      
      const stars = ['‚≠ê', '‚ú®', 'üí´', 'üåü'];
      star.textContent = stars[Math.floor(Math.random() * stars.length)];
      star.style.color = Math.random() > 0.5 ? '#f59e0b' : '#f59e0b';
      
      // Random direction upward
      const angle = (Math.random() * 80 - 40) * Math.PI / 180;
      const velocity = 180 + Math.random() * 180;
      const duration = 1.2 + Math.random() * 0.8;
      const rotation = (Math.random() - 0.5) * 720;
      
      const tx = Math.sin(angle) * velocity;
      const ty = -Math.cos(angle) * velocity;
      
      star.style.left = '100px';
      star.style.bottom = '170px';
      star.style.setProperty('--tx', `${tx}px`);
      star.style.setProperty('--ty', `${ty}px`);
      star.style.setProperty('--rotate', `${rotation}deg`);
      star.style.animationDuration = `${duration}s`;
      
      hat.appendChild(star);
      
      setTimeout(() => {
        star.remove();
      }, duration * 1000);
    }

    // ==========================================
    // BOTTOM NAV AUTO-HIDE ON SCROLL
    // ==========================================
    const bottomNav = document.getElementById('bottom-nav');

    function handleScroll(e) {
      const scrollTop = e.target.scrollTop;
      const scrollHeight = e.target.scrollHeight;
      const clientHeight = e.target.clientHeight;

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏ –∫–æ–Ω–µ—Ü —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Å –∑–∞–ø–∞—Å–æ–º 10px)
      const isAtBottom = scrollTop + clientHeight >= scrollHeight - 10;

      if (isAtBottom) {
        // –î–æ—Å—Ç–∏–≥–ª–∏ –∫–æ–Ω—Ü–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é
        bottomNav.style.transform = 'translateY(0)';
        bottomNav.style.opacity = '1';
      } else {
        // –ù–µ –≤–Ω–∏–∑—É - —Å–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
        bottomNav.style.transform = 'translateY(120px)';
        bottomNav.style.opacity = '0';
      }
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–∫—Ä–æ–ª–ª–∞
    document.querySelector('.dashboard-container')?.addEventListener('scroll', handleScroll);
    document.querySelector('.calendar-container')?.addEventListener('scroll', handleScroll);

    // ==========================================
    // HELPERS
    // ==========================================
    function formatDate(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    function formatDateInput(date) {
      return formatDate(date);
    }

    // ==========================================
    // INIT
    // ==========================================
    document.addEventListener('DOMContentLoaded', () => {
      loadEvents();
      renderCalendar();
      renderSchedule();
      lucide.createIcons();
      
      // Show splash screen
      showSplashScreen();
    });
  </script>
</body>
</html>
